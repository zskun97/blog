(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{376:function(t,e,n){"use strict";n.r(e);var a=n(3),i=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"filebate推送日志假死问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#filebate推送日志假死问题"}},[t._v("#")]),t._v(" filebate推送日志假死问题")]),t._v(" "),e("p",[t._v("生产部署中频繁出现filebate假死导致java服务的日志没办法推送到es中, 开始没在意以为属于运维范围问题没有看, 后期由于需要将python服务重构为java服务, 此时一些重要服务的日志很重要, 所以协助和运维同事一起看了看")]),t._v(" "),e("p",[t._v("首先报错")]),t._v(" "),e("p",[t._v('"Bulk item insert failed (i=0, status=500): {"type":"string_index_out_of_bounds_exception","reason":"String index out of range: 0"}”')]),t._v(" "),e("p",[e("img",{attrs:{src:"/img/question/Untitled.png",alt:"Untitled"}})]),t._v(" "),e("p",[t._v("经过百度有文章指出是在filebate的output.elasticsearch.index配置项有取自上游event中的某个字段, 当这个值不存在时, 向es写入数据报错; 需要确保这个字段一定存在")]),t._v(" "),e("p",[t._v("参考: "),e("a",{attrs:{href:"https://blog.csdn.net/qq_21383435/article/details/124297856",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/qq_21383435/article/details/124297856"),e("OutboundLink")],1),t._v("  第14问")]),t._v(" "),e("p",[t._v("首先查看配置文件")]),t._v(" "),e("p",[e("img",{attrs:{src:"/img/question/Untitled%201.png",alt:"Untitled"}})]),t._v(" "),e("p",[t._v("由于我们是多个服务和多种环境, 所以日志索引分为了三部分,当时不了解怎么取值所以每部分进行了测试验证, 确定了来源…")]),t._v(" "),e("ol",[e("li",[t._v("app_name由各个服务提供,在各自的"),e("code",[t._v("logstash")]),t._v("配置中输出的该字段")])]),t._v(" "),e("p",[e("img",{attrs:{src:"/img/question/Untitled%202.png",alt:"Untitled"}})]),t._v(" "),e("ol",[e("li",[t._v("fields.env是filebate上面自定义的变量, 标识部署环境")])]),t._v(" "),e("p",[e("img",{attrs:{src:"/img/question/Untitled%203.png",alt:"Untitled"}})]),t._v(" "),e("p",[t._v("显然三部分中只有第一部分app_name是从上游取得, 并且做了测试当服务写入的日志不包含该字段时会导致filebate报上面的错误, 所以针对app_name字段进行了判断, 如果不存在app_name字段则索引为默认索引, 也可以方便排查问题日志是怎么生成的")]),t._v(" "),e("p",[t._v("规则参考文档: "),e("a",{attrs:{href:"https://blog.csdn.net/qq_32352777/article/details/124707681",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/qq_32352777/article/details/124707681"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("img",{attrs:{src:"/img/question/Untitled%204.png",alt:"Untitled"}})])])}),[],!1,null,null,null);e.default=i.exports}}]);