<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>shiro简单使用 | 跳跳猪</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="吃得好，睡得好">
    
    <link rel="preload" href="/assets/css/0.styles.542f065b.css" as="style"><link rel="preload" href="/assets/js/app.9ac200f5.js" as="script"><link rel="preload" href="/assets/js/2.f08c2e94.js" as="script"><link rel="preload" href="/assets/js/64.3e3c478f.js" as="script"><link rel="prefetch" href="/assets/js/10.104e03e5.js"><link rel="prefetch" href="/assets/js/11.18d17b89.js"><link rel="prefetch" href="/assets/js/12.31c398a8.js"><link rel="prefetch" href="/assets/js/13.b5ee2d7d.js"><link rel="prefetch" href="/assets/js/14.a60f524e.js"><link rel="prefetch" href="/assets/js/15.55fd61b8.js"><link rel="prefetch" href="/assets/js/16.7aa17999.js"><link rel="prefetch" href="/assets/js/17.24758699.js"><link rel="prefetch" href="/assets/js/18.0b71a4f7.js"><link rel="prefetch" href="/assets/js/19.4770b075.js"><link rel="prefetch" href="/assets/js/20.fe4d448c.js"><link rel="prefetch" href="/assets/js/21.6ef119a3.js"><link rel="prefetch" href="/assets/js/22.68798857.js"><link rel="prefetch" href="/assets/js/23.a8a337ba.js"><link rel="prefetch" href="/assets/js/24.c156d0fe.js"><link rel="prefetch" href="/assets/js/25.b840f4b8.js"><link rel="prefetch" href="/assets/js/26.37c5f756.js"><link rel="prefetch" href="/assets/js/27.5b776d07.js"><link rel="prefetch" href="/assets/js/28.4d89a988.js"><link rel="prefetch" href="/assets/js/29.d8405b8b.js"><link rel="prefetch" href="/assets/js/3.98efb80c.js"><link rel="prefetch" href="/assets/js/30.67c25a87.js"><link rel="prefetch" href="/assets/js/31.cd45304b.js"><link rel="prefetch" href="/assets/js/32.b0bff8a4.js"><link rel="prefetch" href="/assets/js/33.b8e0beb7.js"><link rel="prefetch" href="/assets/js/34.eedead55.js"><link rel="prefetch" href="/assets/js/35.44fef23e.js"><link rel="prefetch" href="/assets/js/36.3e7830e5.js"><link rel="prefetch" href="/assets/js/37.8f711bb3.js"><link rel="prefetch" href="/assets/js/38.3b7df8b6.js"><link rel="prefetch" href="/assets/js/39.a7dfb50c.js"><link rel="prefetch" href="/assets/js/4.2e894fd2.js"><link rel="prefetch" href="/assets/js/40.ba597a3a.js"><link rel="prefetch" href="/assets/js/41.0955ce39.js"><link rel="prefetch" href="/assets/js/42.b1629e72.js"><link rel="prefetch" href="/assets/js/43.606f57ec.js"><link rel="prefetch" href="/assets/js/44.5e8f4801.js"><link rel="prefetch" href="/assets/js/45.fc255c2f.js"><link rel="prefetch" href="/assets/js/46.9222248d.js"><link rel="prefetch" href="/assets/js/47.d6bf833e.js"><link rel="prefetch" href="/assets/js/48.40e23b48.js"><link rel="prefetch" href="/assets/js/49.ba7c2b8d.js"><link rel="prefetch" href="/assets/js/5.d2ef2a1a.js"><link rel="prefetch" href="/assets/js/50.487406c6.js"><link rel="prefetch" href="/assets/js/51.3f8ea397.js"><link rel="prefetch" href="/assets/js/52.acd66974.js"><link rel="prefetch" href="/assets/js/53.58c7fc05.js"><link rel="prefetch" href="/assets/js/54.0f8282f4.js"><link rel="prefetch" href="/assets/js/55.ad7bb205.js"><link rel="prefetch" href="/assets/js/56.590655d9.js"><link rel="prefetch" href="/assets/js/57.9a85aa7a.js"><link rel="prefetch" href="/assets/js/58.1b4ef9fd.js"><link rel="prefetch" href="/assets/js/59.9420c0ba.js"><link rel="prefetch" href="/assets/js/6.65a955fd.js"><link rel="prefetch" href="/assets/js/60.30009201.js"><link rel="prefetch" href="/assets/js/61.0047220f.js"><link rel="prefetch" href="/assets/js/62.a368a893.js"><link rel="prefetch" href="/assets/js/63.3315d70a.js"><link rel="prefetch" href="/assets/js/65.80a47305.js"><link rel="prefetch" href="/assets/js/66.ae967862.js"><link rel="prefetch" href="/assets/js/67.606a99c5.js"><link rel="prefetch" href="/assets/js/68.46eb6539.js"><link rel="prefetch" href="/assets/js/69.c6067a0e.js"><link rel="prefetch" href="/assets/js/7.ed4f4e88.js"><link rel="prefetch" href="/assets/js/8.517c5e6e.js"><link rel="prefetch" href="/assets/js/9.bef30b40.js">
    <link rel="stylesheet" href="/assets/css/0.styles.542f065b.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://excalidraw.com/apple-touch-icon.png" alt="跳跳猪" class="logo"> <span class="site-name can-hide">跳跳猪</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/java/JAVA基础.html" class="nav-link">JAVA</a></div><div class="nav-item"><a href="/md/database/mysql/MySql操作.html" class="nav-link">数据库</a></div><div class="nav-item"><a href="/md/opSystem/linux/linux操作笔记.html" class="nav-link">操作系统</a></div><div class="nav-item"><a href="/md/middleware/mq/消息队列.html" class="nav-link">中间件</a></div><div class="nav-item"><a href="/md/tool/docker/docker.html" class="nav-link">开发工具</a></div><div class="nav-item"><a href="/md/designPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/md/netty/BIO、NIO、AIO.html" class="nav-link">netty</a></div><div class="nav-item"><a href="/md/DDD/小傅哥案例学习打卡/DDD抽奖系统学习打卡🚀 day 1.html" class="nav-link">DDD</a></div><div class="nav-item"><a href="/md/other/面试题.html" class="nav-link">other</a></div><div class="nav-item"><a href="/md/notes/" class="nav-link">测试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="提示语" class="dropdown-title"><!----> <span class="title" style="display:;">测试下拉菜单</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">菜单1</a></li><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">菜单2</a></li><li class="dropdown-item"><h4>多次菜单</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/notes/" class="nav-link">多级菜单1</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/md/java/JAVA基础.html" class="nav-link">JAVA</a></div><div class="nav-item"><a href="/md/database/mysql/MySql操作.html" class="nav-link">数据库</a></div><div class="nav-item"><a href="/md/opSystem/linux/linux操作笔记.html" class="nav-link">操作系统</a></div><div class="nav-item"><a href="/md/middleware/mq/消息队列.html" class="nav-link">中间件</a></div><div class="nav-item"><a href="/md/tool/docker/docker.html" class="nav-link">开发工具</a></div><div class="nav-item"><a href="/md/designPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/md/netty/BIO、NIO、AIO.html" class="nav-link">netty</a></div><div class="nav-item"><a href="/md/DDD/小傅哥案例学习打卡/DDD抽奖系统学习打卡🚀 day 1.html" class="nav-link">DDD</a></div><div class="nav-item"><a href="/md/other/面试题.html" class="nav-link">other</a></div><div class="nav-item"><a href="/md/notes/" class="nav-link">测试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="提示语" class="dropdown-title"><!----> <span class="title" style="display:;">测试下拉菜单</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">菜单1</a></li><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">菜单2</a></li><li class="dropdown-item"><h4>多次菜单</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/notes/" class="nav-link">多级菜单1</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>other</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dcd52e/" class="sidebar-link">面试题</a></li><li><a href="/pages/4778f1/" class="sidebar-link">oAuth2.0基本概念</a></li><li><a href="/pages/3e5ec5/" aria-current="page" class="active sidebar-link">shiro简单使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#自定义令牌实体类" class="sidebar-link">自定义令牌实体类</a></li><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#token生成器" class="sidebar-link">token生成器</a></li><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#customrealm类" class="sidebar-link">CustomRealm类</a></li><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#shiroconfig类" class="sidebar-link">ShiroConfig类</a></li><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#filter类" class="sidebar-link">filter类</a></li><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#_1-首先根据config中路径匹配到对应的自定义filter" class="sidebar-link">1.首先根据config中路径匹配到对应的自定义filter</a></li><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#_2-filter中首先进入onaccessdenied方法-判断请求有没有token" class="sidebar-link">2.filter中首先进入onAccessDenied方法,判断请求有没有token</a></li><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#_3-存在token时便进入executelogin-进行登录步骤-其中会调用filter中的重写的createtoken方法获取token实例-调用subject-login-token-进行具体登录" class="sidebar-link">3.存在token时便进入executeLogin()进行登录步骤 ,其中会调用filter中的重写的createToken方法获取token实例, 调用subject.login(token)进行具体登录</a></li><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#_4-跟随参考链接中的具体流程走回到这一步-用到了我们在realm中重写的supports方法" class="sidebar-link">4.跟随参考链接中的具体流程走回到这一步,用到了我们在Realm中重写的supports方法</a></li><li class="sidebar-sub-header level2"><a href="/pages/3e5ec5/#_5-认证这一步深入便会进入重写的身份认证方法" class="sidebar-link">5.认证这一步深入便会进入重写的身份认证方法</a></li></ul></li><li><a href="/pages/57df53/" class="sidebar-link">filebate推送日志假死问题</a></li><li><a href="/pages/ca5c7f/" class="sidebar-link">springboot框架到2.5.12后redis连接报错</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>md</span></li><li data-v-06225672><span data-v-06225672>other</span></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-10-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">shiro简单使用<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="shiro简单使用"><a href="#shiro简单使用" class="header-anchor">#</a> shiro简单使用</h1> <p><strong>刚开始工作的时候,需要负责用户模块,所以临时学了一下,记个笔记</strong> # Shiro的功能</p> <p><img src="/img/other/image-c73ba1ec421b4390a170d220859d4c27.png" alt="/img/other/image-c73ba1ec421b4390a170d220859d4c27.png"></p> <p>image.png</p> <ul><li>Authentication：身份认证，验证用户是否拥有某个身份。</li> <li>Authorization: 权限校验，验证某个已认证的用户是否拥有某个权限。确定“谁”可以访问“什么”。</li> <li>Session Management：会话管理，管理用户登录后的会话，</li> <li>Cryptography：加密，使用密码学加密数据，如加密密码。</li> <li>Web Support：Web支持，能够比较轻易地整合到Web环境中。</li> <li>Caching：缓存，对用户的数据进行缓存，</li> <li>Concurrency：并发，Apache Shiro支持具有并发功能的多线程应用程序，也就是说支持在多线程应用中并发验证。</li> <li>Testing：测试，提供了测试的支持。</li> <li>Run as ：允许用户以其他用户的身份来登录。</li> <li>Remember me ：记住我</li></ul> <h1 id="依赖包"><a href="#依赖包" class="header-anchor">#</a> 依赖包</h1> <div class="language- extra-class"><pre class="language-text"><code>        &lt;dependency&gt;            &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;            &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt;            &lt;version&gt;1.4.0&lt;/version&gt;        &lt;/dependency&gt;
</code></pre></div><h1 id="写在前面的话"><a href="#写在前面的话" class="header-anchor">#</a> 写在前面的话：</h1> <p>springboot中集成shiro相对简单，只需要两个类：一个是shiroConfig类，一个是CustonRealm类。</p> <p>ShiroConfig类： 顾名思义就是对shiro的一些配置，相对于之前的xml配置。包括：过滤的文件和权限，密码加密的算法，其用注解等相关功能。</p> <p>CustomRealm类： 自定义的CustomRealm继承AuthorizingRealm。并且重写父类中的doGetAuthorizationInfo（权限相关）、doGetAuthenticationInfo（身份认证）这两个方法。</p> <h1 id="简单实现"><a href="#简单实现" class="header-anchor">#</a> 简单实现</h1> <p><img src="/img/other/image-4bbd82caf65e4ecdaa28f8ebcc5ad274.png" alt="/img/other/image-4bbd82caf65e4ecdaa28f8ebcc5ad274.png"></p> <p>image.png</p> <p>共需要5个文件</p> <p>CustomRealm: 自定义的认证源, 身份认证和权限认证</p> <p>OAuthToken: token实体类</p> <p>ShiroConfig: shiro的一些配置，相对于之前的xml配置。包括：过滤的文件和权限，密码加密的算法，其用注解等相关功能</p> <p>TestFilter 自定义过滤器</p> <p>TokenGenerator token生成器, 测试功能流程的话可以不用这个, 实际中生成token的逻辑</p> <h2 id="自定义令牌实体类"><a href="#自定义令牌实体类" class="header-anchor">#</a> 自定义令牌实体类</h2> <div class="language- extra-class"><pre class="language-text"><code>package com.atguigu.gulimall.shiro_demo.config;import org.apache.shiro.authc.AuthenticationToken;/** * @author zhangshaokun * @date 2021/3/11 * 自定义令牌实体类 */public class OAuthToken implements AuthenticationToken {        private String token;        public OAuthToken(String token){            this.token = token;        }        @Override        public String getPrincipal() {            return token;        }        @Override        public Object getCredentials() {            return token;        }    }
</code></pre></div><h2 id="token生成器"><a href="#token生成器" class="header-anchor">#</a> token生成器</h2> <div class="language- extra-class"><pre class="language-text"><code>package com.atguigu.gulimall.shiro_demo.demo;import java.security.MessageDigest;import java.util.UUID;/** * 生成token * */public class TokenGenerator {    public static String generateValue() {        return generateValue(UUID.randomUUID().toString());    }    private static final char[] hexCode = &quot;0123456789abcdef&quot;.toCharArray();    public static String toHexString(byte[] data) {        if(data == null) {            return null;        }        StringBuilder r = new StringBuilder(data.length*2);        for ( byte b : data) {            r.append(hexCode[(b &gt;&gt; 4) &amp; 0xF]);            r.append(hexCode[(b &amp; 0xF)]);        }        return r.toString();    }    public static String generateValue(String param) {        try {            MessageDigest algorithm = MessageDigest.getInstance(&quot;MD5&quot;);            algorithm.reset();            algorithm.update(param.getBytes());            byte[] messageDigest = algorithm.digest();            return toHexString(messageDigest);        } catch (Exception e) {            // 这个可具体更改,现在做例子不动了,可以自定义异常类进行抛出提醒            throw new RuntimeException(&quot;生成Token失败&quot;, e);        }    }}
</code></pre></div><h2 id="customrealm类"><a href="#customrealm类" class="header-anchor">#</a> CustomRealm类</h2> <p>自定义认证源</p> <div class="language- extra-class"><pre class="language-text"><code>package com.atguigu.gulimall.shiro_demo.demo;import org.apache.shiro.authc.*;import org.apache.shiro.authz.AuthorizationInfo;import org.apache.shiro.authz.SimpleAuthorizationInfo;import org.apache.shiro.realm.AuthorizingRealm;import org.apache.shiro.subject.PrincipalCollection;import org.springframework.stereotype.Component;import org.springframework.util.StringUtils;import java.util.HashMap;import java.util.HashSet;import java.util.Map;import java.util.Set;/** * @author zhangshaokun * @date 2021/3/11 */@Componentpublic class CustomRealm extends AuthorizingRealm {    @Override    public boolean supports(AuthenticationToken token) {        return token instanceof OAuthToken;    }    /**     * 权限认证，即登录过后，每个身份不一定，对应的所能看的页面也不一样     * */    @Override    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) {        //这个里面存储的是主要身份信息,来源便是下面身份认证最后存入的第一个参数        Object primaryPrincipal = principalCollection.getPrimaryPrincipal();        //利用这些信息,便能从数据库或者其他位置获取权限列表了,具体实现略        //获取用户的权限列表,存入set中        Set&lt;String&gt; permsSet = new HashSet&lt;&gt;();        //授权信息实例        SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();        //传入一个set        info.setStringPermissions(permsSet);        return info;    }    /**     * 身份认证。即登录通过账号和密码验证登陆人的身份信息     * */    @Override    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException {        //获取token        String token = (String) authenticationToken.getPrincipal();        //通过token获取用户信息, 比如token和用户信息存储在redis或数据库, 那么便根据token去查询        //这里用map模拟数据库        Map&lt;String, String&gt; token_value = new HashMap&lt;&gt;();        token_value.put(&quot;6110e95350b2af23be9c70b93d0c118f&quot;,&quot;张三&quot;);        token_value.put(&quot;token2&quot;,&quot;李四&quot;);        //判断是否读取到信息        String value = token_value.get(token);        //如果没有查询到信息,或者token设置的时间已经过期        if (StringUtils.isEmpty(value)){            System.out.println(&quot;token失效，请重新登录&quot;);            throw new IncorrectCredentialsException(&quot;token失效，请重新登录&quot;);        }        //token有效, 就查询用户的详细信息        //还可以在做一些判断,比如用户有没有被注销,被封禁等等        //具体实现略        String str = &quot;&quot;;  //这个只是临时传参避免报错的        // 将用户信息(具体类型看需求,可以是简单的string也可以是对象,要方便上面权限认证是容易获取用户信息), token 传入        SimpleAuthenticationInfo info = new SimpleAuthenticationInfo(str, token, getName());        return info;    }}
</code></pre></div><h2 id="shiroconfig类"><a href="#shiroconfig类" class="header-anchor">#</a> ShiroConfig类</h2> <div class="language- extra-class"><pre class="language-text"><code>package com.atguigu.gulimall.shiro_demo.demo;import org.apache.shiro.mgt.SecurityManager;import org.apache.shiro.spring.web.ShiroFilterFactoryBean;import org.apache.shiro.web.mgt.DefaultWebSecurityManager;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import javax.servlet.Filter;import java.util.HashMap;import java.util.LinkedHashMap;import java.util.Map;/** * @author zhangshaokun * @date 2021/3/11 */@Configurationpublic class ShiroConfig {    /*随记: 根据三个方法的引用顺序排了序*/    /*这里CustomRealm类没有加注解注册到spring框架,所以方法new出来返回的,如果类上加了,这里可以省略这个方法    * 比如给CustomRealm类用Component注解进行注册后, 直接向securityManager(CustomRealm customRealm)方法中传参即可,如下*//*    @Bean    public CustomRealm customRealm() {        CustomRealm customRealm = new CustomRealm();        return customRealm;    }*/    /*SecurityManger:SecurityManager是Shiro核心，主要协调Shiro内部的各种安全组件，这个我们不需要太关注，只需要知道可以设置自定的Realm*/    @Bean(&quot;securityManager&quot;)    public SecurityManager securityManager(CustomRealm customRealm) {        DefaultWebSecurityManager defaultSecurityManager = new DefaultWebSecurityManager();        //存入Realm        defaultSecurityManager.setRealm(customRealm);        return defaultSecurityManager;    }    /*bean名称必须是shiroFilter*/    @Bean(&quot;shiroFilter&quot;)    public ShiroFilterFactoryBean shiroFilter(SecurityManager securityManager) {        //创建一个shiroFilter实例        ShiroFilterFactoryBean shiroFilter = new ShiroFilterFactoryBean();        //配置Manager        shiroFilter.setSecurityManager(securityManager);        //自定义过滤规则,可以自定义多个, 通过map传入        Map&lt;String, Filter&gt; filters = new HashMap&lt;&gt;();        //第一个参数过滤器, 第二个参数是具体的过滤器实例        filters.put(&quot;oauth2&quot;, new TestFilter());        //将自定义的过滤器加入shiroFilter中        shiroFilter.setFilters(filters);        //设置登录路径,设置后登录路径下不走认证,也可以用下面kv的形式写入        shiroFilter.setLoginUrl(&quot;/login&quot;);        //设置权限不足是跳转页面        shiroFilter.setUnauthorizedUrl(&quot;/notRole&quot;);        //上面两个方法不能很全面,所以可以通过LinkedHashMap向过滤器传入过滤配置, 因为存入的规则是有序的        Map&lt;String, String&gt; filterMap = new LinkedHashMap&lt;&gt;();        //第一个参数是路径, 第二个参数字典值,标识过滤规则        //authc:所有url都必须认证通过才可以访问; anon:所有url都都可以匿名访问        //需要注意匹配按照上下顺序来的,  如果/**写在最前面那么,后面的都被覆盖了        filterMap.put(&quot;/sys/login&quot;,&quot;anon&quot;);  //这个的意思就是 /sys/login 可以匿名访问不进行认证        filterMap.put(&quot;/swagger/**&quot;, &quot;anon&quot;); //可以用**进行匹配所有子路径        filterMap.put(&quot;/swagger-ui.html&quot;, &quot;anon&quot;);  //也可以是静态文件        filterMap.put(&quot;/admin/**&quot;, &quot;authc&quot;);  //admin下所有都必须通过认证才能访问        filterMap.put(&quot;/test/**&quot;, &quot;oauth2&quot;);  //还可以指定自定义的过滤规则        filterMap.put(&quot;/**&quot;, &quot;oauth2&quot;);        //将上面配置的kv存入        shiroFilter.setFilterChainDefinitionMap(filterMap);        //返回        return shiroFilter;    }}
</code></pre></div><h2 id="filter类"><a href="#filter类" class="header-anchor">#</a> filter类</h2> <div class="language- extra-class"><pre class="language-text"><code>package com.atguigu.gulimall.shiro_demo.demo;import org.apache.shiro.authc.AuthenticationToken;import org.apache.shiro.web.filter.authc.AuthenticatingFilter;import org.springframework.util.StringUtils;import javax.servlet.http.HttpServletRequest;/** * @author zhangshaokun * @date 2021/3/11 * 自定义的过滤器 */public class TestFilter extends AuthenticatingFilter{    @Override    protected AuthenticationToken createToken(javax.servlet.ServletRequest servletRequest, javax.servlet.ServletResponse servletResponse) throws Exception {        //获取请求token        String token = getRequestToken((HttpServletRequest) servletRequest);        //如果携带没有携带token,则返回null        if(StringUtils.isEmpty(token)){            return null;        }        //携带了token便返回自定义的token实例        return new OAuthToken(token);    }    @Override    protected boolean onAccessDenied(javax.servlet.ServletRequest servletRequest, javax.servlet.ServletResponse servletResponse) throws Exception {        //获取请求token        String token = getRequestToken((HttpServletRequest) servletRequest);        //如果不存在返回401, 这里简化为输出,实际中要给前端返回401及其他错误信息        if(StringUtils.isEmpty(token)){            System.out.println(&quot;错误401:token为空&quot;);            return false;        }        return executeLogin(servletRequest, servletResponse);    }    /**     * 获取请求中的token     */    private String getRequestToken(HttpServletRequest httpRequest){        //从header中获取token        String token = httpRequest.getHeader(&quot;token&quot;);        //如果header中不存在token，则从参数中获取token        if(StringUtils.isEmpty(token)){            token = httpRequest.getParameter(&quot;token&quot;);        }        return token;    }}
</code></pre></div><h1 id="自定义认证时流程"><a href="#自定义认证时流程" class="header-anchor">#</a> 自定义认证时流程</h1> <p>参考链接: https://blog.csdn.net/long270022471/article/details/62423286</p> <h2 id="_1-首先根据config中路径匹配到对应的自定义filter"><a href="#_1-首先根据config中路径匹配到对应的自定义filter" class="header-anchor">#</a> 1.首先根据config中路径匹配到对应的自定义filter</h2> <p><img src="/img/other/image-f566ebe06bad466794ae3ab516d01189.png" alt="/img/other/image-f566ebe06bad466794ae3ab516d01189.png"></p> <p>image.png</p> <h2 id="_2-filter中首先进入onaccessdenied方法-判断请求有没有token"><a href="#_2-filter中首先进入onaccessdenied方法-判断请求有没有token" class="header-anchor">#</a> 2.filter中首先进入onAccessDenied方法,判断请求有没有token</h2> <p><img src="/img/other/image-ba93fcf5eb07406787dc64e4302d7ced.png" alt="/img/other/image-ba93fcf5eb07406787dc64e4302d7ced.png"></p> <p>image.png</p> <h2 id="_3-存在token时便进入executelogin-进行登录步骤-其中会调用filter中的重写的createtoken方法获取token实例-调用subject-login-token-进行具体登录"><a href="#_3-存在token时便进入executelogin-进行登录步骤-其中会调用filter中的重写的createtoken方法获取token实例-调用subject-login-token-进行具体登录" class="header-anchor">#</a> 3.存在token时便进入executeLogin()进行登录步骤 ,其中会调用filter中的重写的createToken方法获取token实例, 调用subject.login(token)进行具体登录</h2> <p><img src="/img/other/image-2f3661f1182c4d198589d545d03ede04-20211228215222257.png" alt="/img/other/image-2f3661f1182c4d198589d545d03ede04-20211228215222257.png"></p> <p>image.png</p> <h2 id="_4-跟随参考链接中的具体流程走回到这一步-用到了我们在realm中重写的supports方法"><a href="#_4-跟随参考链接中的具体流程走回到这一步-用到了我们在realm中重写的supports方法" class="header-anchor">#</a> 4.跟随参考链接中的具体流程走回到这一步,用到了我们在Realm中重写的supports方法</h2> <p><img src="/img/other/image-0650dc5edfec47c5b59722b884cf1b88.png" alt="/img/other/image-0650dc5edfec47c5b59722b884cf1b88.png"></p> <p>image.png</p> <h2 id="_5-认证这一步深入便会进入重写的身份认证方法"><a href="#_5-认证这一步深入便会进入重写的身份认证方法" class="header-anchor">#</a> 5.认证这一步深入便会进入重写的身份认证方法</h2> <p><img src="/img/other/image-5211d35d40884e2fb335161078d1a44d.png" alt="/img/other/image-5211d35d40884e2fb335161078d1a44d.png"></p> <p>image.png</p></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/4778f1/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">oAuth2.0基本概念</div></a> <a href="/pages/57df53/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">filebate推送日志假死问题</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/4778f1/" class="prev">oAuth2.0基本概念</a></span> <span class="next"><a href="/pages/57df53/">filebate推送日志假死问题</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>张大喵</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9ac200f5.js" defer></script><script src="/assets/js/2.f08c2e94.js" defer></script><script src="/assets/js/64.3e3c478f.js" defer></script>
  </body>
</html>
