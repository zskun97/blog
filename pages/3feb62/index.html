<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQå®ç°å»¶æ—¶é˜Ÿåˆ—+æ‹“å±• | è·³è·³çŒª</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="åƒå¾—å¥½ï¼Œç¡å¾—å¥½">
    
    <link rel="preload" href="/assets/css/0.styles.542f065b.css" as="style"><link rel="preload" href="/assets/js/app.9ac200f5.js" as="script"><link rel="preload" href="/assets/js/2.f08c2e94.js" as="script"><link rel="preload" href="/assets/js/49.ba7c2b8d.js" as="script"><link rel="prefetch" href="/assets/js/10.104e03e5.js"><link rel="prefetch" href="/assets/js/11.18d17b89.js"><link rel="prefetch" href="/assets/js/12.31c398a8.js"><link rel="prefetch" href="/assets/js/13.b5ee2d7d.js"><link rel="prefetch" href="/assets/js/14.a60f524e.js"><link rel="prefetch" href="/assets/js/15.55fd61b8.js"><link rel="prefetch" href="/assets/js/16.7aa17999.js"><link rel="prefetch" href="/assets/js/17.24758699.js"><link rel="prefetch" href="/assets/js/18.0b71a4f7.js"><link rel="prefetch" href="/assets/js/19.4770b075.js"><link rel="prefetch" href="/assets/js/20.fe4d448c.js"><link rel="prefetch" href="/assets/js/21.6ef119a3.js"><link rel="prefetch" href="/assets/js/22.68798857.js"><link rel="prefetch" href="/assets/js/23.a8a337ba.js"><link rel="prefetch" href="/assets/js/24.c156d0fe.js"><link rel="prefetch" href="/assets/js/25.b840f4b8.js"><link rel="prefetch" href="/assets/js/26.37c5f756.js"><link rel="prefetch" href="/assets/js/27.5b776d07.js"><link rel="prefetch" href="/assets/js/28.4d89a988.js"><link rel="prefetch" href="/assets/js/29.d8405b8b.js"><link rel="prefetch" href="/assets/js/3.98efb80c.js"><link rel="prefetch" href="/assets/js/30.67c25a87.js"><link rel="prefetch" href="/assets/js/31.cd45304b.js"><link rel="prefetch" href="/assets/js/32.b0bff8a4.js"><link rel="prefetch" href="/assets/js/33.b8e0beb7.js"><link rel="prefetch" href="/assets/js/34.eedead55.js"><link rel="prefetch" href="/assets/js/35.44fef23e.js"><link rel="prefetch" href="/assets/js/36.3e7830e5.js"><link rel="prefetch" href="/assets/js/37.8f711bb3.js"><link rel="prefetch" href="/assets/js/38.3b7df8b6.js"><link rel="prefetch" href="/assets/js/39.a7dfb50c.js"><link rel="prefetch" href="/assets/js/4.2e894fd2.js"><link rel="prefetch" href="/assets/js/40.ba597a3a.js"><link rel="prefetch" href="/assets/js/41.0955ce39.js"><link rel="prefetch" href="/assets/js/42.b1629e72.js"><link rel="prefetch" href="/assets/js/43.606f57ec.js"><link rel="prefetch" href="/assets/js/44.5e8f4801.js"><link rel="prefetch" href="/assets/js/45.fc255c2f.js"><link rel="prefetch" href="/assets/js/46.9222248d.js"><link rel="prefetch" href="/assets/js/47.d6bf833e.js"><link rel="prefetch" href="/assets/js/48.40e23b48.js"><link rel="prefetch" href="/assets/js/5.d2ef2a1a.js"><link rel="prefetch" href="/assets/js/50.487406c6.js"><link rel="prefetch" href="/assets/js/51.3f8ea397.js"><link rel="prefetch" href="/assets/js/52.acd66974.js"><link rel="prefetch" href="/assets/js/53.58c7fc05.js"><link rel="prefetch" href="/assets/js/54.0f8282f4.js"><link rel="prefetch" href="/assets/js/55.ad7bb205.js"><link rel="prefetch" href="/assets/js/56.590655d9.js"><link rel="prefetch" href="/assets/js/57.9a85aa7a.js"><link rel="prefetch" href="/assets/js/58.1b4ef9fd.js"><link rel="prefetch" href="/assets/js/59.9420c0ba.js"><link rel="prefetch" href="/assets/js/6.65a955fd.js"><link rel="prefetch" href="/assets/js/60.30009201.js"><link rel="prefetch" href="/assets/js/61.0047220f.js"><link rel="prefetch" href="/assets/js/62.a368a893.js"><link rel="prefetch" href="/assets/js/63.3315d70a.js"><link rel="prefetch" href="/assets/js/64.3e3c478f.js"><link rel="prefetch" href="/assets/js/65.80a47305.js"><link rel="prefetch" href="/assets/js/66.ae967862.js"><link rel="prefetch" href="/assets/js/67.606a99c5.js"><link rel="prefetch" href="/assets/js/68.46eb6539.js"><link rel="prefetch" href="/assets/js/69.c6067a0e.js"><link rel="prefetch" href="/assets/js/7.ed4f4e88.js"><link rel="prefetch" href="/assets/js/8.517c5e6e.js"><link rel="prefetch" href="/assets/js/9.bef30b40.js">
    <link rel="stylesheet" href="/assets/css/0.styles.542f065b.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://excalidraw.com/apple-touch-icon.png" alt="è·³è·³çŒª" class="logo"> <span class="site-name can-hide">è·³è·³çŒª</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/java/JAVAåŸºç¡€.html" class="nav-link">JAVA</a></div><div class="nav-item"><a href="/md/database/mysql/MySqlæ“ä½œ.html" class="nav-link">æ•°æ®åº“</a></div><div class="nav-item"><a href="/md/opSystem/linux/linuxæ“ä½œç¬”è®°.html" class="nav-link">æ“ä½œç³»ç»Ÿ</a></div><div class="nav-item"><a href="/md/middleware/mq/æ¶ˆæ¯é˜Ÿåˆ—.html" class="nav-link">ä¸­é—´ä»¶</a></div><div class="nav-item"><a href="/md/tool/docker/docker.html" class="nav-link">å¼€å‘å·¥å…·</a></div><div class="nav-item"><a href="/md/designPattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div><div class="nav-item"><a href="/md/netty/BIOã€NIOã€AIO.html" class="nav-link">netty</a></div><div class="nav-item"><a href="/md/DDD/å°å‚…å“¥æ¡ˆä¾‹å­¦ä¹ æ‰“å¡/DDDæŠ½å¥–ç³»ç»Ÿå­¦ä¹ æ‰“å¡ğŸš€ day 1.html" class="nav-link">DDD</a></div><div class="nav-item"><a href="/md/other/é¢è¯•é¢˜.html" class="nav-link">other</a></div><div class="nav-item"><a href="/md/notes/" class="nav-link">æµ‹è¯•</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æç¤ºè¯­" class="dropdown-title"><!----> <span class="title" style="display:;">æµ‹è¯•ä¸‹æ‹‰èœå•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">èœå•1</a></li><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">èœå•2</a></li><li class="dropdown-item"><h4>å¤šæ¬¡èœå•</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/notes/" class="nav-link">å¤šçº§èœå•1</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/md/java/JAVAåŸºç¡€.html" class="nav-link">JAVA</a></div><div class="nav-item"><a href="/md/database/mysql/MySqlæ“ä½œ.html" class="nav-link">æ•°æ®åº“</a></div><div class="nav-item"><a href="/md/opSystem/linux/linuxæ“ä½œç¬”è®°.html" class="nav-link">æ“ä½œç³»ç»Ÿ</a></div><div class="nav-item"><a href="/md/middleware/mq/æ¶ˆæ¯é˜Ÿåˆ—.html" class="nav-link">ä¸­é—´ä»¶</a></div><div class="nav-item"><a href="/md/tool/docker/docker.html" class="nav-link">å¼€å‘å·¥å…·</a></div><div class="nav-item"><a href="/md/designPattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div><div class="nav-item"><a href="/md/netty/BIOã€NIOã€AIO.html" class="nav-link">netty</a></div><div class="nav-item"><a href="/md/DDD/å°å‚…å“¥æ¡ˆä¾‹å­¦ä¹ æ‰“å¡/DDDæŠ½å¥–ç³»ç»Ÿå­¦ä¹ æ‰“å¡ğŸš€ day 1.html" class="nav-link">DDD</a></div><div class="nav-item"><a href="/md/other/é¢è¯•é¢˜.html" class="nav-link">other</a></div><div class="nav-item"><a href="/md/notes/" class="nav-link">æµ‹è¯•</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æç¤ºè¯­" class="dropdown-title"><!----> <span class="title" style="display:;">æµ‹è¯•ä¸‹æ‹‰èœå•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">èœå•1</a></li><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">èœå•2</a></li><li class="dropdown-item"><h4>å¤šæ¬¡èœå•</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/notes/" class="nav-link">å¤šçº§èœå•1</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>æ¶ˆæ¯ä¸­é—´ä»¶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/799774/" class="sidebar-link">æ¶ˆæ¯é˜Ÿåˆ—</a></li><li><a href="/pages/3feb62/" aria-current="page" class="active sidebar-link">RabbitMQå®ç°å»¶æ—¶é˜Ÿåˆ—+æ‹“å±•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/3feb62/#å®‰è£…æ’ä»¶" class="sidebar-link">å®‰è£…æ’ä»¶</a></li><li class="sidebar-sub-header level2"><a href="/pages/3feb62/#pomä¾èµ–" class="sidebar-link">pomä¾èµ–</a></li><li class="sidebar-sub-header level2"><a href="/pages/3feb62/#application-yml" class="sidebar-link">application.yml</a></li><li class="sidebar-sub-header level2"><a href="/pages/3feb62/#é™æ€å¸¸é‡ã€æšä¸¾" class="sidebar-link">é™æ€å¸¸é‡ã€æšä¸¾</a></li><li class="sidebar-sub-header level2"><a href="/pages/3feb62/#configé…ç½®ç±»" class="sidebar-link">configé…ç½®ç±»</a></li><li class="sidebar-sub-header level2"><a href="/pages/3feb62/#æ¶ˆæ¯å®ä½“ç±»" class="sidebar-link">æ¶ˆæ¯å®ä½“ç±»</a></li><li class="sidebar-sub-header level2"><a href="/pages/3feb62/#ç”Ÿäº§è€…" class="sidebar-link">ç”Ÿäº§è€…</a></li><li class="sidebar-sub-header level2"><a href="/pages/3feb62/#æ¶ˆè´¹è€…" class="sidebar-link">æ¶ˆè´¹è€…</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Elasticsearch</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/3c9356/" class="sidebar-link">Elasticsearch</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>md</span></li><li data-v-06225672><span data-v-06225672>middleware</span></li><li data-v-06225672><span data-v-06225672>mq</span></li></ul> <div class="info" data-v-06225672><!----> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-10-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">RabbitMQå®ç°å»¶æ—¶é˜Ÿåˆ—+æ‹“å±•<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="rabbitmqå®ç°å»¶æ—¶é˜Ÿåˆ—-æ‹“å±•rabbitmq-delayed-message-exchangeæ’ä»¶å®ç°ä¸ç­‰æ—¶å»¶è¿Ÿé˜Ÿåˆ—"><a href="#rabbitmqå®ç°å»¶æ—¶é˜Ÿåˆ—-æ‹“å±•rabbitmq-delayed-message-exchangeæ’ä»¶å®ç°ä¸ç­‰æ—¶å»¶è¿Ÿé˜Ÿåˆ—" class="header-anchor">#</a> RabbitMQå®ç°å»¶æ—¶é˜Ÿåˆ— + æ‹“å±•rabbitmq_delayed_message_exchangeæ’ä»¶å®ç°ä¸ç­‰æ—¶å»¶è¿Ÿé˜Ÿåˆ—</h1> <h1 id="é€šè¿‡-ttl-æ­»ä¿¡é˜Ÿåˆ—-å®ç°å»¶æ—¶é˜Ÿåˆ—"><a href="#é€šè¿‡-ttl-æ­»ä¿¡é˜Ÿåˆ—-å®ç°å»¶æ—¶é˜Ÿåˆ—" class="header-anchor">#</a> é€šè¿‡ TTL+æ­»ä¿¡é˜Ÿåˆ— å®ç°å»¶æ—¶é˜Ÿåˆ—</h1> <p>TTL: ç”Ÿå­˜æ—¶é—´å€¼</p> <p>ç›®å‰æœ‰ä¸¤ç§, ä¸€ç§å¯¹æ¶ˆæ¯è®¾ç½®, ä¸€ç§å¯¹é˜Ÿåˆ—è®¾ç½®</p> <ol><li>å¯¹é˜Ÿåˆ—è®¾ç½®, é˜Ÿåˆ—ä¸­æ‰€æœ‰æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´éƒ½æ˜¯ç›¸åŒçš„, é˜Ÿåˆ—å…ˆå…¥å…ˆå‡º, å› ä¸ºå‰é¢è‚¯å®šæ˜¯å…ˆè¿‡æœŸçš„,æ²¡æœ‰é—®é¢˜</li> <li>å¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´, å› ä¸ºé˜Ÿåˆ—å…ˆå…¥å…ˆå‡ºåŸåˆ™, åªæœ‰å½“å‰æ¶ˆæ¯è¢«å–å‡ºæ‰ä¼šåˆ¤æ–­ä¸‹ä¸€ä¸ªæ¶ˆæ¯æ˜¯å¦è¿‡æœŸ ä¸¾ä¾‹: å…ˆæ”¾å…¥20Sè¿‡æœŸçš„æ¶ˆæ¯A,å†æ”¾å…¥10Sè¿‡æœŸçš„æ¶ˆæ¯B, ç†æƒ³çŠ¶æ€æ˜¯ B å…ˆè¿‡æœŸè¢«è½¬å‘æ¶ˆè´¹äº†, ç„¶å A è¿‡æœŸè½¬å‘è¢«æ¶ˆè´¹ å®é™…æƒ…å†µæ˜¯: Aåœ¨é˜Ÿåˆ—å¤´ä¸€è‡´å µç€ , å½“è¿‡æœŸæ—¶é—´åˆ°äº†, A è¢«è½¬å‘, è¿™æ—¶æ‰ä¼šåˆ¤æ–­ B çš„è¿‡æœŸæ—¶é—´</li> <li>å¦‚æœåŒæ—¶å¯¹é˜Ÿåˆ—å’Œæ¶ˆæ¯è®¾ç½®äº†è¿‡æœŸæ—¶é—´, é‚£ä¹ˆæ ¹æ®å°çš„å€¼åˆ¤æ–­è¿‡æœŸ</li></ol> <p>å½“ä¸€ä¸ªæ¶ˆæ¯è¿‡æœŸå°±ä¼šå˜ä¸ºæ­»ä¿¡, æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®æ­»ä¿¡äº¤æ¢æœºå’Œè·¯ç”±é”®, å°†æ­»ä¿¡å‘åˆ°æŒ‡å®šçš„é˜Ÿåˆ—, ä¹Ÿå°±æ˜¯æ­»ä¿¡é˜Ÿåˆ— ; <strong>è¿™æ ·åªè¦æˆ‘ä»¬ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—è¿›è¡Œæ¶ˆè´¹, ä»è€Œå®ç°å»¶æ—¶æ•ˆæœ</strong></p> <p><img src="/img/other/image-ba0deb43fc464c41bbd679f43dfce994.png" alt="/img/other/image-ba0deb43fc464c41bbd679f43dfce994.png"></p> <p>image.png</p> <p><strong>æ‰€ä»¥ä¸ªäººè®¤ä¸ºé€šè¿‡TTLçš„æ–¹å¼åšå»¶æ—¶é˜Ÿåˆ—, åªé€‚åˆè¿‡æœŸæ—¶é—´ç›¸åŒçš„æƒ…å†µ , æ¯”å¦‚è®¢å•å¾…æ”¯ä»˜æ—¶é—´éƒ½æ˜¯30åˆ†é’Ÿç­‰ç­‰, æ‰€ä»¥ä¸‹é¢ä¾‹å­ä¸­ä»¥é˜Ÿåˆ—è®¾ç½®TTLä¸ºä¸», æ¶ˆæ¯TTLçš„ä»£ç è¢«æ³¨é‡Šäº†, å¯ä»¥è‡ªå·±æ‰“å¼€è¯•è¯•</strong></p> <p><strong>ä¸‹é¢demoä¸­ä¹ŸåŒ…å«äº†ä½¿ç”¨æ’ä»¶çš„ä»£ç , ä¸è¿‡ä¸å¤šå¦‚æœä¸ä½¿ç”¨æ’ä»¶çš„æ–¹å¼å°±åˆ æ‰å¥½äº† ,æœç´¢â€œæ‹“å±•æ’ä»¶åä½¿ç”¨â€ å°±æ‰¾åˆ°äº†</strong></p> <h1 id="é€šè¿‡æ‹“å±•æ’ä»¶å®ç°å»¶æ—¶é˜Ÿåˆ—"><a href="#é€šè¿‡æ‹“å±•æ’ä»¶å®ç°å»¶æ—¶é˜Ÿåˆ—" class="header-anchor">#</a> é€šè¿‡æ‹“å±•æ’ä»¶å®ç°å»¶æ—¶é˜Ÿåˆ—</h1> <p>æ’ä»¶å¯¹rabbitmqçš„ç‰ˆæœ¬æœ‰é™åˆ¶, å…·ä½“å¯ä»¥çœ‹githubä¸Šçš„è¯´æ˜</p> <h2 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="header-anchor">#</a> å®‰è£…æ’ä»¶</h2> <p><a href="https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases" target="_blank" rel="noopener noreferrer">rabbitmq-delayed-message-exchange<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>å› ä¸ºæˆ‘æ˜¯dockeréƒ¨ç½²,æ‰€ä»¥æ˜¯dockerå‘½ä»¤, linuxç›´æ¥cp</p> <div class="language- extra-class"><pre class="language-text"><code>docker cp æ’ä»¶æ–‡ä»¶ å®¹å™¨å:/plugins
</code></pre></div><p>è¿›å…¥å®¹å™¨</p> <div class="language- extra-class"><pre class="language-text"><code>docker exec -it å®¹å™¨å bash
</code></pre></div><p>æŸ¥çœ‹æ’ä»¶åˆ—è¡¨</p> <div class="language- extra-class"><pre class="language-text"><code>rabbitmq-plugins list
</code></pre></div><p>å¯ç”¨æ’ä»¶</p> <div class="language- extra-class"><pre class="language-text"><code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange
</code></pre></div><p>linuxçš„å¯èƒ½å¾—é‡å¯</p> <p>é‡æ–°æŸ¥çœ‹ä¸€ä¸‹æ’ä»¶åˆ—è¡¨,å¦‚æœå‰é¢ä¸­æ‹¬å·æœ‰ä¸ª e* é‚£å°±æ˜¯okäº†</p> <p>ä»£ç å®ä¾‹åœ¨ä¸‹é¢, ä¸è¿‡å’ŒTTLçš„æ··åœ¨ä¸€èµ·äº†â€¦</p> <p>å’Œæ™®é€šçš„æ”¹åŠ¨ç‚¹æœ‰ä¸¤å¤„</p> <ol><li><p>é…ç½®ç±»ä¸­å£°æ˜äº¤æ¢æœºæ—¶,typeæŒ‡å®šx-delayed-message</p> <div class="language- extra-class"><pre class="language-text"><code>@BeanCustomExchange messageDelayedDirect() {    Map&lt;String, Object&gt; args = new HashMap&lt;&gt;();    //è¿™é‡ŒæŒ‡å®šäº†directæ¨¡å¼    args.put(&quot;x-delayed-type&quot;, &quot;direct&quot;);    return new CustomExchange(äº¤æ¢æœºçš„åç§°,&quot;x-delayed-message&quot;,true, false,args);}
</code></pre></div></li> <li><p>å‘é€æ¶ˆæ¯æ—¶,éœ€è¦é€šè¿‡headeré…ç½®è¿‡æœŸæ—¶é—´</p> <div class="language- extra-class"><pre class="language-text"><code>rabbitTemplate.convertAndSend(RabbitMQEnum.DELAYED_MESSAGE_COMBINATION.getExchange(), RabbitMQEnum.DELAYED_MESSAGE_COMBINATION.getRouteKey(), msg, message -&gt; {                // è®¾ç½®å»¶è¿Ÿæ¯«ç§’å€¼ æ˜¯setHeader, ä»¥x-delayä¸ºkey                message.getMessageProperties().setHeader(&quot;x-delay&quot;,String.valueOf(messageContent.getDelay()*1000));                return message;            },correlationData);
</code></pre></div></li></ol> <h1 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h1> <h2 id="pomä¾èµ–"><a href="#pomä¾èµ–" class="header-anchor">#</a> pomä¾èµ–</h2> <div class="language- extra-class"><pre class="language-text"><code>&lt;!--        ä¸»è¦çš„ä¾èµ–--&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--        ä¹Ÿåªæ˜¯æ¶ˆæ¯ä½“jsonè½¬æ¢æ—¶ç”¨åˆ°äº†,å¦‚æœæœ‰å°±ä¸ç”¨åŠ äº†--&gt;&lt;dependency&gt;    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;    &lt;version&gt;5.6.3&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;    &lt;artifactId&gt;lombok&lt;/artifactId&gt;    &lt;version&gt;RELEASE&lt;/version&gt;    &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt;
</code></pre></div><h2 id="application-yml"><a href="#application-yml" class="header-anchor">#</a> application.yml</h2> <p>æ ¹æ®è‡ªå·±çš„æƒ…å†µå¡«å†™</p> <div class="language- extra-class"><pre class="language-text"><code>spring:  rabbitmq:    host: è‡ªå·±rabbitmqçš„ip    port: 5672    username: guest    password: guestserver:  port: 8765
</code></pre></div><h2 id="é™æ€å¸¸é‡ã€æšä¸¾"><a href="#é™æ€å¸¸é‡ã€æšä¸¾" class="header-anchor">#</a> é™æ€å¸¸é‡ã€æšä¸¾</h2> <p>é™æ€å¸¸é‡æ”¾çš„éƒ½æ˜¯äº¤æ¢æœºå’Œé˜Ÿåˆ—çš„name</p> <p>æšä¸¾é‡Œé¢æ˜¯æ ¹æ®ä¸åŒçš„ç»‘å®šæƒ…å†µå¯¹äº¤æ¢æœºã€é˜Ÿåˆ—ã€è·¯ç”±é”®çš„ç»„åˆ</p> <p>è‡ªå·±ç”¨çš„æ–¹ä¾¿, å•ç‹¬åœ¨ä»£ç é‡Œé¢å†™ä¹Ÿä¸å½±å“</p> <div class="language- extra-class"><pre class="language-text"><code>/** * å­˜æ”¾äº¤æ¢æœºå’Œé˜Ÿåˆ—åç§° */public class RabbitMqContent {    /**     * æ™®é€šæ¶ˆæ¯é€šçŸ¥é˜Ÿåˆ—åç§°     */    public static final String MESSAGE_QUEUE_NAME=&quot;message.ordinary.queue&quot;;    /**     * ttl(å»¶æ—¶)æ¶ˆæ¯é€šçŸ¥é˜Ÿåˆ—åç§°     */    public static final String MESSAGE_TTL_QUEUE_NAME=&quot;message.ttl.queue&quot;;    /**     * ttl(å»¶æ—¶)æ¶ˆæ¯é€šçŸ¥é˜Ÿåˆ— è¿‡æœŸæ—¶é—´ æ¯«ç§’     */    public static final int MESSAGE_TTL_QUEUE_TTL=10*1000;    /**     * æ™®é€šäº¤æ¢æœºåç§° directæ¨¡å¼     */    public static final String ORDINARY_DIRECT_EXCHANGE_NAME=&quot;message.ordinary.direct.exchange&quot;;    /**æ‹“å±•æ’ä»¶åä½¿ç”¨     * Delayedå»¶æ—¶äº¤æ¢æœºåç§° directæ¨¡å¼     */    public static final String DELAYED_DIRECT_EXCHANGE_NAME=&quot;message.Delayed.direct.exchange&quot;;}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>/** * ç»„åˆæšä¸¾ */public enum RabbitMQEnum {    /**     * æ™®é€šæ¶ˆæ¯é€šçŸ¥ç»„åˆ  æ™®é€šäº¤æ¢æœº æ™®é€šé˜Ÿåˆ—     */    ORDINARY_MESSAGE_COMBINATION(RabbitMqContent.ORDINARY_DIRECT_EXCHANGE_NAME, RabbitMqContent.MESSAGE_QUEUE_NAME, RabbitMqContent.MESSAGE_QUEUE_NAME),    /**     * å»¶æ—¶æ¶ˆæ¯ç»„åˆ   æ™®é€šäº¤æ¢æœº  å»¶æ—¶é˜Ÿåˆ—     */    TTL_MESSAGE_COMBINATION(RabbitMqContent.ORDINARY_DIRECT_EXCHANGE_NAME, RabbitMqContent.MESSAGE_TTL_QUEUE_NAME, RabbitMqContent.MESSAGE_TTL_QUEUE_NAME),    /**æ‹“å±•æ’ä»¶åä½¿ç”¨     * æ’ä»¶å®ç°å»¶æ—¶äº¤æ¢æœº   å»¶è¿Ÿäº¤æ¢æœº  æ™®é€šé˜Ÿåˆ—     */    DELAYED_MESSAGE_COMBINATION(RabbitMqContent.DELAYED_DIRECT_EXCHANGE_NAME, RabbitMqContent.MESSAGE_QUEUE_NAME, RabbitMqContent.MESSAGE_QUEUE_NAME);    /**     * äº¤æ¢æœºåç§°     */    private String exchange;    /**     * é˜Ÿåˆ—åç§°     */    private String queue;    /**     * è·¯ç”±é”®     */    private String routeKey;    RabbitMQEnum(String exchange, String name, String routeKey) {        this.exchange = exchange;        this.queue = name;        this.routeKey = routeKey;    }    public String getExchange() {        return exchange;    }    public void setExchange(String exchange) {        this.exchange = exchange;    }    public String getQueue() {        return queue;    }    public void setQueue(String name) {        this.queue = name;    }    public String getRouteKey() {        return routeKey;    }    public void setRouteKey(String routeKey) {        this.routeKey = routeKey;    }}
</code></pre></div><h2 id="configé…ç½®ç±»"><a href="#configé…ç½®ç±»" class="header-anchor">#</a> configé…ç½®ç±»</h2> <div class="language- extra-class"><pre class="language-text"><code>@Configurationpublic class RabbitMqConfiguration {    /*=====================&gt;å£°æ˜äº¤æ¢æœº&lt;=====================*/    /**     * æ™®é€šæ¶ˆæ¯äº¤æ¢æœº     *     * @return     */    @Bean    DirectExchange messageDirect() {        return ExchangeBuilder                .directExchange(RabbitMqContent.ORDINARY_DIRECT_EXCHANGE_NAME)                .durable(true)                .build();    }    /**æ‹“å±•æ’ä»¶åä½¿ç”¨     * ä½¿ç”¨æ’ä»¶å®ç°çš„å»¶è¿Ÿäº¤æ¢æœº     *     * @return     */    @Bean    CustomExchange messageDelayedDirect() {        Map&lt;String, Object&gt; args = new HashMap&lt;&gt;();        args.put(&quot;x-delayed-type&quot;, &quot;direct&quot;);        return new CustomExchange(RabbitMqContent.DELAYED_DIRECT_EXCHANGE_NAME,&quot;x-delayed-message&quot;,true, false,args);    }    /*======================&gt;å£°æ˜é˜Ÿåˆ—&lt;======================*/    /**     * æ™®é€šæ¶ˆæ¯é˜Ÿåˆ—é…ç½®     *     * @return     */    @Bean    public Queue messageQueue() {        return QueueBuilder.durable(RabbitMqContent.MESSAGE_QUEUE_NAME).build();    }    /**     * TTLæ¶ˆæ¯é˜Ÿåˆ—é…ç½®     *     * @return     */    @Bean    Queue messageTtlQueue() {        return QueueBuilder                .durable(RabbitMqContent.MESSAGE_TTL_QUEUE_NAME)                //é…ç½®åˆ°æœŸåè½¬å‘åˆ°çš„äº¤æ¢æœºå’Œè·¯ç”±key, ä¹Ÿå°±æ˜¯å®é™…è¦è½¬å‘åˆ°å“ªé‡Œ  è¿™é‡Œç”¨ æ™®é€šæ¶ˆæ¯ç»„åˆ å»æ¶ˆè´¹                .deadLetterExchange(RabbitMQEnum.ORDINARY_MESSAGE_COMBINATION.getExchange())                .deadLetterRoutingKey(RabbitMQEnum.ORDINARY_MESSAGE_COMBINATION.getRouteKey())                //å¯¹é˜Ÿåˆ—è®¾ç½®è¿‡æœŸæ—¶é—´,å¦‚æœè¦åªå¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´,å»æ‰ä¸‹é¢è¿™è¡Œ                .ttl(RabbitMqContent.MESSAGE_TTL_QUEUE_TTL)                .build();    }    /*======================&gt;ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº&lt;======================*/    /**     * æ™®é€šé˜Ÿåˆ—å’Œæ™®é€šäº¤æ¢æœºçš„ç»‘å®š-routekey     *     * @param messageDirect æ¶ˆæ¯ä¸­å¿ƒäº¤æ¢é…ç½®     * @param messageQueue  æ¶ˆæ¯ä¸­å¿ƒé˜Ÿåˆ—     * @return     */    @Bean    Binding messageBinding(DirectExchange messageDirect, Queue messageQueue) {        return BindingBuilder                .bind(messageQueue)                .to(messageDirect)                .with(RabbitMQEnum.ORDINARY_MESSAGE_COMBINATION.getRouteKey());    }    /**     * ttlå»¶æ—¶é˜Ÿåˆ—å’Œæ™®é€šäº¤æ¢æœºçš„ç»‘å®š-routekey     *     * @param messageTtlQueue     * @param messageDirect     * @return     */    @Bean    public Binding messageTtlBinding(Queue messageTtlQueue, DirectExchange messageDirect) {        return BindingBuilder                .bind(messageTtlQueue)                .to(messageDirect)                .with(RabbitMQEnum.TTL_MESSAGE_COMBINATION.getRouteKey());    }    /**æ‹“å±•æ’ä»¶åä½¿ç”¨     * æ™®é€šæ¶ˆæ¯é˜Ÿåˆ—å’ŒDelayedå»¶è¿Ÿäº¤æ¢æœºçš„ç»‘å®š-routekey     *     * @param messageQueue     * @param messageDelayedDirect     * @return     */    @Bean    public Binding messageDelayedBinding(Queue messageQueue, CustomExchange messageDelayedDirect) {        return BindingBuilder                .bind(messageQueue)                .to(messageDelayedDirect)                .with(RabbitMQEnum.DELAYED_MESSAGE_COMBINATION.getRouteKey()).noargs();    }}
</code></pre></div><h2 id="æ¶ˆæ¯å®ä½“ç±»"><a href="#æ¶ˆæ¯å®ä½“ç±»" class="header-anchor">#</a> æ¶ˆæ¯å®ä½“ç±»</h2> <div class="language- extra-class"><pre class="language-text"><code>@Datapublic class MessagePojo implements Serializable {    //å»¶è¿Ÿæ—¶é—´    private int delay;    //æ¶ˆæ¯ä½“    private Map&lt;String, Object&gt; params;    //åˆ›å»ºæ—¶é—´    private String createTime;    //æ¶ˆæ¯id    private String messageId;}
</code></pre></div><h2 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="header-anchor">#</a> ç”Ÿäº§è€…</h2> <div class="language- extra-class"><pre class="language-text"><code>@Slf4j@Componentpublic class MessageProvider implements RabbitTemplate.ConfirmCallback {    /**     * RabbitMQ æ¨¡ç‰ˆæ¶ˆæ¯å®ç°ç±»     */    protected RabbitTemplate rabbitTemplate;    public MessageProvider(RabbitTemplate rabbitTemplate){        this.rabbitTemplate = rabbitTemplate;        this.rabbitTemplate.setMandatory(true);        this.rabbitTemplate.setConfirmCallback(this);    }    private String msgPojoStr;    /**     * ä½¿ç”¨ttlå»¶æ—¶æ¶ˆæ¯ç»„åˆå‘é€     * @param messageContent     */    public void sendMessage(MessagePojo messageContent) {        if (messageContent != null){            messageContent.setMessageId(UUID.randomUUID().toString());            messageContent.setCreateTime(LocalDateTime.now().toString());            String msg = JSONUtil.toJsonStr(messageContent);            msgPojoStr = msg;            log.info(&quot;é€šè¿‡{}é˜Ÿåˆ—å»¶æ—¶{}ç§’å†™å…¥{}é˜Ÿåˆ—ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{}&quot;, RabbitMQEnum.TTL_MESSAGE_COMBINATION.getQueue(), RabbitMqContent.MESSAGE_TTL_QUEUE_TTL/1000, RabbitMQEnum.ORDINARY_MESSAGE_COMBINATION.getQueue(), msg);            CorrelationData correlationData = new CorrelationData(messageContent.getMessageId());            /*TTLæœ‰ä¸¤ç§,ä¸€ç§å¯¹æ¶ˆæ¯è®¾ç½®, ä¸€ç§å¯¹é˜Ÿåˆ—è®¾ç½®             1. å¯¹é˜Ÿåˆ—è®¾ç½®, æ‰€æœ‰çš„æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´éƒ½æ˜¯ç›¸åŒçš„, æ‰€ä»¥é˜Ÿåˆ—å…ˆå…¥å…ˆå‡º, æ²¡æœ‰é—®é¢˜ , å› ä¸ºå‰é¢è‚¯å®šæ˜¯å…ˆè¿‡æœŸçš„             2. å¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´, å› ä¸ºé˜Ÿåˆ—å…ˆå…¥å…ˆå‡ºåŸåˆ™, åªæœ‰å½“å‰é¢çš„æ¶ˆæ¯è¢«å–å‡ºæ‰ä¼šåˆ¤æ–­å½“å‰æ¶ˆæ¯æ˜¯å¦è¿‡æœŸ                ä¸¾ä¾‹: å…ˆæ”¾å…¥20Sè¿‡æœŸçš„æ¶ˆæ¯A,å†æ”¾å…¥10Sè¿‡æœŸçš„æ¶ˆæ¯B, ç†æƒ³çŠ¶æ€æ˜¯ B å…ˆè¿‡æœŸè¢«è½¬å‘æ¶ˆè´¹äº†, ç„¶å A è¿‡æœŸè½¬å‘è¢«æ¶ˆè´¹                å®é™…æƒ…å†µæ˜¯ Aåœ¨é˜Ÿåˆ—å¤´ä¸€è‡´å µç€ , å½“è¿‡æœŸæ—¶é—´åˆ°äº†, A è¢«è½¬å‘, è¿™æ—¶æ‰ä¼šåˆ¤æ–­ B çš„è¿‡æœŸæ—¶é—´             3. å¦‚æœåŒæ—¶å¯¹é˜Ÿåˆ—å’Œæ¶ˆæ¯è®¾ç½®äº†è¿‡æœŸæ—¶é—´, é‚£ä¹ˆæ ¹æ®å°çš„å€¼åˆ¤æ–­è¿‡æœŸ             */            //æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœº            rabbitTemplate.convertAndSend(RabbitMQEnum.TTL_MESSAGE_COMBINATION.getExchange(), RabbitMQEnum.TTL_MESSAGE_COMBINATION.getRouteKey(), msg,correlationData);            //å¦‚æœä½ æƒ³æµ‹è¯•åªå¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´,å¯ä»¥æ³¨è°ƒä¸Šä¸€è¡Œ,å°†ä¸‹é¢è¿™æ®µä»£ç æ”¾å¼€, ç„¶åå°†RabbitMqConfigurationä¸­messageTtlQueueçš„ttlæ³¨è°ƒ è®°å¾—æ”¹ä¸€ä¸‹ä¸Šé¢logè¾“å‡ºçš„å»¶æ—¶æ—¶é•¿çš„å–å€¼            /*rabbitTemplate.convertAndSend(RabbitMQEnum.TTL_MESSAGE_COMBINATION.getExchange(), RabbitMQEnum.TTL_MESSAGE_COMBINATION.getRouteKey(), msg, message -&gt; {                // è®¾ç½®å»¶è¿Ÿæ¯«ç§’å€¼                message.getMessageProperties().setExpiration(String.valueOf(messageContent.getDelay()*1000));                return message;            },correlationData);*/        }else {            log.warn(&quot;æ¶ˆæ¯å†…å®¹ä¸ºç©ºï¼ï¼ï¼ï¼ï¼&quot;);        }    }    /**æ‹“å±•æ’ä»¶åä½¿ç”¨     * ä½¿ç”¨å»¶æ—¶äº¤æ¢æœºå‘é€å»¶è¿Ÿæ¶ˆæ¯     * @param messageContent     */    public void sendDelayedMessage(MessagePojo messageContent) {        if (messageContent != null){            messageContent.setMessageId(UUID.randomUUID().toString());            messageContent.setCreateTime(LocalDateTime.now().toString());            String msg = JSONUtil.toJsonStr(messageContent);            msgPojoStr = msg;            log.info(&quot;é€šè¿‡å»¶æ—¶äº¤æ¢æœºå»¶æ—¶{}ç§’å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼š{}ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{}&quot;, messageContent.getDelay(), RabbitMQEnum.DELAYED_MESSAGE_COMBINATION.getQueue(), msg);            // æ‰§è¡Œå‘é€æ¶ˆæ¯åˆ°æŒ‡å®šé˜Ÿåˆ—            CorrelationData correlationData = new CorrelationData(messageContent.getMessageId());            rabbitTemplate.convertAndSend(RabbitMQEnum.DELAYED_MESSAGE_COMBINATION.getExchange(), RabbitMQEnum.DELAYED_MESSAGE_COMBINATION.getRouteKey(), msg, message -&gt; {                // è®¾ç½®å»¶è¿Ÿæ¯«ç§’å€¼ æ˜¯setHeader, ä»¥x-delayä¸ºkey                message.getMessageProperties().setHeader(&quot;x-delay&quot;,String.valueOf(messageContent.getDelay()*1000));                return message;            },correlationData);        }else {            log.warn(&quot;æ¶ˆæ¯å†…å®¹ä¸ºç©ºï¼ï¼ï¼ï¼ï¼&quot;);        }    }    /**     * å‘é€ç¡®è®¤     */    @Override    public void confirm(CorrelationData correlationData, boolean b, String s) {        System.out.println(&quot; å›è°ƒid:&quot; + correlationData);        if (b) {            System.out.println(msgPojoStr+&quot;:æ¶ˆæ¯å‘é€æˆåŠŸ&quot;);        } else {            log.warn(msgPojoStr+&quot;:æ¶ˆæ¯å‘é€å¤±è´¥:&quot; + s);        }    }}
</code></pre></div><h2 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="header-anchor">#</a> æ¶ˆè´¹è€…</h2> <div class="language- extra-class"><pre class="language-text"><code>@Slf4j@Component@RabbitListener(queues = RabbitMqContent.MESSAGE_QUEUE_NAME)public class MessageConsumer {    @RabbitHandler    public void handler(String msg, Channel channel, Message message) throws IOException {        if (!StringUtils.isEmpty(msg)) {            MessagePojo messagePojo = JSONUtil.toBean(msg, MessagePojo.class);            LocalDateTime now = LocalDateTime.now();            LocalDateTime parse = LocalDateTime.parse(messagePojo.getCreateTime());            long l = Duration.between(parse,now).toMillis();            log.info(&quot;[æ”¶åˆ°å»¶æ—¶æ¶ˆæ¯] æ¥æ”¶æ—¶é—´:{},å»¶æ—¶æ—¶é—´:{}ç§’,æ¶ˆæ¯ä½“:{}&quot;,now,l/1000D,JSONUtil.toJsonStr(messagePojo));        }    }}
</code></pre></div><h1 id="ä¸¤è€…æ¯”è¾ƒ"><a href="#ä¸¤è€…æ¯”è¾ƒ" class="header-anchor">#</a> ä¸¤è€…æ¯”è¾ƒ</h1> <p>TTL æ˜¯åˆ°è¾¾é˜Ÿåˆ—åæ‰åšè¿‡æœŸæ—¶é—´åˆ¤æ–­, åªé€‚ç”¨äºè¿‡æœŸæ—¶é—´ç›¸åŒçš„æƒ…å†µ</p> <p>æ’ä»¶çš„æ–¹å¼, æ˜¯åœ¨äº¤æ¢æœºä¸­åˆ¤æ–­æ¶ˆæ¯çš„æ—¶é—´, åˆ°è¾¾æ—¶é—´åæ‰æ ¹æ®è§„åˆ™å‘é€åˆ°é˜Ÿåˆ—, æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´æ›´çµæ´»</p> <p>æ’ä»¶ç›¸æ¯”è¾ƒTTLå› ä¸ºä¸éœ€è¦é¢å¤–çš„é˜Ÿåˆ—åšä¸­è½¬, æ‰€ä»¥ä½¿ç”¨ä¸Šæ›´æ–¹ä¾¿,ä½†æ˜¯å®é™…æƒ…å†µä¸ä¸€å®šå…è®¸è®©ä½ å®‰è£…æ’ä»¶, è€Œä¸”æ’ä»¶æ–¹å¼çš„å¯é æ€§æˆ‘è¿˜æ²¡æµ‹è¿‡â€¦.</p></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/799774/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">æ¶ˆæ¯é˜Ÿåˆ—</div></a> <a href="/pages/3c9356/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Elasticsearch</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/799774/" class="prev">æ¶ˆæ¯é˜Ÿåˆ—</a></span> <span class="next"><a href="/pages/3c9356/">Elasticsearch</a>â†’
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2022
    <span>å¼ å¤§å–µ</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9ac200f5.js" defer></script><script src="/assets/js/2.f08c2e94.js" defer></script><script src="/assets/js/49.ba7c2b8d.js" defer></script>
  </body>
</html>
