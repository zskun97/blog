<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HashMap | 跳跳猪</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="吃得好，睡得好">
    
    <link rel="preload" href="/assets/css/0.styles.542f065b.css" as="style"><link rel="preload" href="/assets/js/app.9eea15e6.js" as="script"><link rel="preload" href="/assets/js/2.f08c2e94.js" as="script"><link rel="preload" href="/assets/js/16.2888c1b2.js" as="script"><link rel="prefetch" href="/assets/js/10.12e67808.js"><link rel="prefetch" href="/assets/js/11.d3df5b45.js"><link rel="prefetch" href="/assets/js/12.422bbc2d.js"><link rel="prefetch" href="/assets/js/13.0e8e1751.js"><link rel="prefetch" href="/assets/js/14.1cefb67a.js"><link rel="prefetch" href="/assets/js/15.6db16ffa.js"><link rel="prefetch" href="/assets/js/17.465d0651.js"><link rel="prefetch" href="/assets/js/18.64474359.js"><link rel="prefetch" href="/assets/js/19.23f3e7d6.js"><link rel="prefetch" href="/assets/js/20.de24a1e8.js"><link rel="prefetch" href="/assets/js/21.b6ad6f40.js"><link rel="prefetch" href="/assets/js/3.72784d31.js"><link rel="prefetch" href="/assets/js/4.2e894fd2.js"><link rel="prefetch" href="/assets/js/5.5e2ac693.js"><link rel="prefetch" href="/assets/js/6.b2a60611.js"><link rel="prefetch" href="/assets/js/7.adedf7f2.js"><link rel="prefetch" href="/assets/js/8.ec28826b.js"><link rel="prefetch" href="/assets/js/9.e76d8e43.js">
    <link rel="stylesheet" href="/assets/css/0.styles.542f065b.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://excalidraw.com/apple-touch-icon.png" alt="跳跳猪" class="logo"> <span class="site-name can-hide">跳跳猪</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/java/JAVA基础.html" class="nav-link">JAVA</a></div><div class="nav-item"><a href="/md/notes/" class="nav-link">测试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="提示语" class="dropdown-title"><!----> <span class="title" style="display:;">测试下拉菜单</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">菜单1</a></li><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">菜单2</a></li><li class="dropdown-item"><h4>多次菜单</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/notes/" class="nav-link">多级菜单1</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/md/java/JAVA基础.html" class="nav-link">JAVA</a></div><div class="nav-item"><a href="/md/notes/" class="nav-link">测试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="提示语" class="dropdown-title"><!----> <span class="title" style="display:;">测试下拉菜单</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">菜单1</a></li><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">菜单2</a></li><li class="dropdown-item"><h4>多次菜单</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/notes/" class="nav-link">多级菜单1</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JAVA</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dc132d/" class="sidebar-link">JAVA基础</a></li><li><a href="/pages/d9f5d1/" class="sidebar-link">java8新特性</a></li><li><a href="/pages/b4de67/" class="sidebar-link">JVM</a></li><li><a href="/pages/4ef7a0/" class="sidebar-link">Spring</a></li><li><a href="/pages/4bcf6f/" class="sidebar-link">SpringBoot</a></li><li><a href="/pages/bf25fe/" class="sidebar-link">Gateway网关</a></li><li><a href="/pages/7a7d4b/" class="sidebar-link">并发常见</a></li><li><a href="/pages/fd10b9/" class="sidebar-link">分布式事务</a></li><li><a href="/pages/74109b/" class="sidebar-link">springboot整合多数据源</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>数据结构和算法</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/682583/" aria-current="page" class="active sidebar-link">HashMap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/682583/#初始化容量" class="sidebar-link">初始化容量</a></li><li class="sidebar-sub-header level2"><a href="/pages/682583/#负载因子" class="sidebar-link">负载因子</a></li><li class="sidebar-sub-header level2"><a href="/pages/682583/#数据迁移" class="sidebar-link">数据迁移</a></li><li class="sidebar-sub-header level2"><a href="/pages/682583/#扩容机制" class="sidebar-link">扩容机制</a></li><li class="sidebar-sub-header level2"><a href="/pages/682583/#链表树化" class="sidebar-link">链表树化</a></li></ul></li><li><a href="/pages/0eae9f/" class="sidebar-link">List</a></li><li><a href="/pages/3255a7/" class="sidebar-link">树</a></li><li><a href="/pages/ee1728/" class="sidebar-link">HashCode为什么使用31作乘数</a></li></ul></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>md</span></li><li data-v-06225672><span data-v-06225672>java</span></li><li data-v-06225672><span data-v-06225672>数据结构和算法</span></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-10-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">HashMap<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="hashmap"><a href="#hashmap" class="header-anchor">#</a> HashMap</h1> <p>HashMap 最早出现在 JDK 1.2中，底层基于散列算法实现。HashMap 允许 null 键和 null 值，在计算哈键的哈希值时，null 键哈希值为 0。HashMap 并不保证键值对的顺序，这意味着在进行某些操作后，键值对的顺序可能会发生变化。另外，需要注意的是，HashMap 是非线程安全类，在多线程环境下可能会存在问题。</p> <p>初始化map的大小是16</p> <h1 id="简单原理"><a href="#简单原理" class="header-anchor">#</a> 简单原理</h1> <p>如何理解hashMap的原理, 可以简化理解为数组+链表</p> <p>将每个key的hash值与数组的长度取模运算得到一个数组的下标, 然后将key放入, 如果多个key在同一下标的情况, 那么它们在这个位置以链表的形式存储</p> <p>以上就是最简化的思路</p> <h1 id="扰动函数"><a href="#扰动函数" class="header-anchor">#</a> 扰动函数</h1> <p>简单的取模运算分布还不够随机, 所以在取到哈希值后还进行了扰动运算 (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16) . 将哈希值右移16位, 也就是自己长度的一半, 之后与哈希值做异或运算, 这样混合了原哈希值中的高位和低位, 增大了随机性.</p> <p>使用扰动函数就是为了增加随机性, 让数据元素更加均衡的散列, 减少碰撞</p> <h1 id="初始化容量和负载因子"><a href="#初始化容量和负载因子" class="header-anchor">#</a> 初始化容量和负载因子</h1> <h2 id="初始化容量"><a href="#初始化容量" class="header-anchor">#</a> 初始化容量</h2> <p>默认容量为16</p> <p>初始容量为2的倍数时, 才会出现01111这样的值</p> <p>如果初始化HashMap时定义的长度不是2的倍数, 那么会寻找比初始值大的最小的那个2进制数值, 比如17会找到32</p> <h2 id="负载因子"><a href="#负载因子" class="header-anchor">#</a> 负载因子</h2> <p>默认负载因子是0.75f</p> <p>在HashMap中, 负载因子决定了数据量多少以后进行扩容</p> <p>所以默认值0.75f , 是在数组长度的3/4的下标被使用时, 会进行扩容</p> <h1 id="扩容元素拆分"><a href="#扩容元素拆分" class="header-anchor">#</a> 扩容元素拆分</h1> <p>在扩容时需要将元素重新拆分到新的数组中. 拆分过程中, jdk1.7还会重新计算哈希值, 1.8之后不在重新计算</p> <h2 id="数据迁移"><a href="#数据迁移" class="header-anchor">#</a> 数据迁移</h2> <p>通过测试发现 原扰动哈希值与扩容新增出来的长度16, 进行&amp;运算, 如果值等于0, 则不需要变动位置, 不为0需要在原位置加上新增长度</p> <p>这样就不用每个元素重新计算扰动hash</p> <h1 id="插入"><a href="#插入" class="header-anchor">#</a> 插入</h1> <p>HashMap插入数据流程图</p> <p><img src="https://bugstack.cn/assets/images/2020/interview/interview-5-01.png" alt="https://bugstack.cn/assets/images/2020/interview/interview-5-01.png"></p> <ol><li><p>进行哈希值扰动, 得到新哈希值 。<code>tab[i = (n - 1) &amp; hash])</code></p></li> <li><p>判断tab是否为空或者长度为0 , 如果是进行扩容操作</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 初始化桶数组 table，table 被延迟到插入新数据时再进行初始化</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>根据哈希值计算下标, 如果对应下标没有存放数据, 则直接插入;
如果存在值并且key也存在则进行值覆盖</p></li> <li><p>如果key不存在, 判断当前下标中是否是树节点, 是则向树节点插入数据, 否则向链表插入数据</p></li> <li><p>向链表插入数据时, 判断链表长度大于等于8, 则需要把链表转换为红黑树。<code>treeifyBin(tab, hash);</code></p></li> <li><p>最后所有元素处理完之后, 判断是否超过阈值, 超过则扩容</p></li> <li><p><code>treeifyBin</code>,是一个链表转树的方法，但不是所有的链表长度为8后都会转成树，还需要判断存放key值的数组桶长度是否小于64 <code>MIN_TREEIFY_CAPACITY</code>。如果小于则需要扩容，扩容后链表上的数据会被拆分散列的相应的桶节点上，也就把链表长度缩短了。</p></li></ol> <h2 id="扩容机制"><a href="#扩容机制" class="header-anchor">#</a> 扩容机制</h2> <p>HashMap是基于数组+链表和红黑树实现的, 但用于存放key值的数组桶的长度时固定的, 由初始化决定.</p> <ol><li>扩容时计算出新的newCap、newThr，这是两个单词的缩写，一个是Capacity ，另一个是阀Threshold</li> <li>newCap用于创新的数组桶 <code>new Node[newCap];</code></li> <li>随着扩容后，原来那些因为哈希碰撞，存放成链表和红黑树的元素，都需要进行拆分存放到新的位置中。</li></ol> <h2 id="链表树化"><a href="#链表树化" class="header-anchor">#</a> 链表树化</h2> <p>HashMap这种散列表的数据结构，最大的性能在于可以O(1)时间复杂度定位到元素，但因为哈希碰撞不得已在一个下标里存放多组数据，那么jdk1.8之前的设计只是采用链表的方式进行存放，如果需要从链表中定位到数据时间复杂度就是O(n)，链表越长性能越差。因为在jdk1.8中把过长的链表也就是8个，优化为自平衡的红黑树结构，以此让定位元素的时间复杂度优化近似于O(logn)，这样来提升元素查找的效率。但也不是完全抛弃链表，因为在元素相对不多的情况下，链表的插入速度更快，所以综合考虑下设定阈值为8才进行红黑树转换操作。</p> <p><img src="https://bugstack.cn/assets/images/2020/interview/interview-5-02.png" alt="https://bugstack.cn/assets/images/2020/interview/interview-5-02.png"></p> <ol><li>链表树化的条件有两点；链表长度大于等于8、桶容量大于64，否则只是扩容，不会树化。</li> <li>链表树化的过程中是先由链表转换为树节点，此时的树可能不是一颗平衡树。同时在树转换过程中会记录链表的顺序，<code>tl.next = p</code>，这主要方便后续树转链表和拆分更方便。</li> <li>链表转换成树完成后，在进行红黑树的转换。先简单介绍下，红黑树的转换需要染色和旋转，以及比对大小。在比较元素的大小中，有一个比较有意思的方法，<code>tieBreakOrder</code>加时赛，这主要是因为HashMap没有像TreeMap那样本身就有Comparator的实现。</li></ol> <h1 id="查找"><a href="#查找" class="header-anchor">#</a> 查找</h1> <p><img src="https://bugstack.cn/assets/images/2020/interview/interview-5-03.png" alt="https://bugstack.cn/assets/images/2020/interview/interview-5-03.png"></p> <h1 id="删除"><a href="#删除" class="header-anchor">#</a> 删除</h1> <h1 id="遍历"><a href="#遍历" class="header-anchor">#</a> 遍历</h1> <p><img src="https://bugstack.cn/assets/images/2020/interview/interview-5-05.png" alt="https://bugstack.cn/assets/images/2020/interview/interview-5-05.png"></p> <p>第一顺序是按照数组下标进行遍历, 数组桶中的元素按照链表首尾顺序遍历,</p></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/74109b/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">springboot整合多数据源</div></a> <a href="/pages/0eae9f/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">List</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/74109b/" class="prev">springboot整合多数据源</a></span> <span class="next"><a href="/pages/0eae9f/">List</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>张大喵</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9eea15e6.js" defer></script><script src="/assets/js/2.f08c2e94.js" defer></script><script src="/assets/js/16.2888c1b2.js" defer></script>
  </body>
</html>
