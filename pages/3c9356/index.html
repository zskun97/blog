<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Elasticsearch | è·³è·³çŒª</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="åƒå¾—å¥½ï¼Œç¡å¾—å¥½">
    
    <link rel="preload" href="/assets/css/0.styles.542f065b.css" as="style"><link rel="preload" href="/assets/js/app.9ac200f5.js" as="script"><link rel="preload" href="/assets/js/2.f08c2e94.js" as="script"><link rel="preload" href="/assets/js/48.40e23b48.js" as="script"><link rel="prefetch" href="/assets/js/10.104e03e5.js"><link rel="prefetch" href="/assets/js/11.18d17b89.js"><link rel="prefetch" href="/assets/js/12.31c398a8.js"><link rel="prefetch" href="/assets/js/13.b5ee2d7d.js"><link rel="prefetch" href="/assets/js/14.a60f524e.js"><link rel="prefetch" href="/assets/js/15.55fd61b8.js"><link rel="prefetch" href="/assets/js/16.7aa17999.js"><link rel="prefetch" href="/assets/js/17.24758699.js"><link rel="prefetch" href="/assets/js/18.0b71a4f7.js"><link rel="prefetch" href="/assets/js/19.4770b075.js"><link rel="prefetch" href="/assets/js/20.fe4d448c.js"><link rel="prefetch" href="/assets/js/21.6ef119a3.js"><link rel="prefetch" href="/assets/js/22.68798857.js"><link rel="prefetch" href="/assets/js/23.a8a337ba.js"><link rel="prefetch" href="/assets/js/24.c156d0fe.js"><link rel="prefetch" href="/assets/js/25.b840f4b8.js"><link rel="prefetch" href="/assets/js/26.37c5f756.js"><link rel="prefetch" href="/assets/js/27.5b776d07.js"><link rel="prefetch" href="/assets/js/28.4d89a988.js"><link rel="prefetch" href="/assets/js/29.d8405b8b.js"><link rel="prefetch" href="/assets/js/3.98efb80c.js"><link rel="prefetch" href="/assets/js/30.67c25a87.js"><link rel="prefetch" href="/assets/js/31.cd45304b.js"><link rel="prefetch" href="/assets/js/32.b0bff8a4.js"><link rel="prefetch" href="/assets/js/33.b8e0beb7.js"><link rel="prefetch" href="/assets/js/34.eedead55.js"><link rel="prefetch" href="/assets/js/35.44fef23e.js"><link rel="prefetch" href="/assets/js/36.3e7830e5.js"><link rel="prefetch" href="/assets/js/37.8f711bb3.js"><link rel="prefetch" href="/assets/js/38.3b7df8b6.js"><link rel="prefetch" href="/assets/js/39.a7dfb50c.js"><link rel="prefetch" href="/assets/js/4.2e894fd2.js"><link rel="prefetch" href="/assets/js/40.ba597a3a.js"><link rel="prefetch" href="/assets/js/41.0955ce39.js"><link rel="prefetch" href="/assets/js/42.b1629e72.js"><link rel="prefetch" href="/assets/js/43.606f57ec.js"><link rel="prefetch" href="/assets/js/44.5e8f4801.js"><link rel="prefetch" href="/assets/js/45.fc255c2f.js"><link rel="prefetch" href="/assets/js/46.9222248d.js"><link rel="prefetch" href="/assets/js/47.d6bf833e.js"><link rel="prefetch" href="/assets/js/49.ba7c2b8d.js"><link rel="prefetch" href="/assets/js/5.d2ef2a1a.js"><link rel="prefetch" href="/assets/js/50.487406c6.js"><link rel="prefetch" href="/assets/js/51.3f8ea397.js"><link rel="prefetch" href="/assets/js/52.acd66974.js"><link rel="prefetch" href="/assets/js/53.58c7fc05.js"><link rel="prefetch" href="/assets/js/54.0f8282f4.js"><link rel="prefetch" href="/assets/js/55.ad7bb205.js"><link rel="prefetch" href="/assets/js/56.590655d9.js"><link rel="prefetch" href="/assets/js/57.9a85aa7a.js"><link rel="prefetch" href="/assets/js/58.1b4ef9fd.js"><link rel="prefetch" href="/assets/js/59.9420c0ba.js"><link rel="prefetch" href="/assets/js/6.65a955fd.js"><link rel="prefetch" href="/assets/js/60.30009201.js"><link rel="prefetch" href="/assets/js/61.0047220f.js"><link rel="prefetch" href="/assets/js/62.a368a893.js"><link rel="prefetch" href="/assets/js/63.3315d70a.js"><link rel="prefetch" href="/assets/js/64.3e3c478f.js"><link rel="prefetch" href="/assets/js/65.80a47305.js"><link rel="prefetch" href="/assets/js/66.ae967862.js"><link rel="prefetch" href="/assets/js/67.606a99c5.js"><link rel="prefetch" href="/assets/js/68.46eb6539.js"><link rel="prefetch" href="/assets/js/69.c6067a0e.js"><link rel="prefetch" href="/assets/js/7.ed4f4e88.js"><link rel="prefetch" href="/assets/js/8.517c5e6e.js"><link rel="prefetch" href="/assets/js/9.bef30b40.js">
    <link rel="stylesheet" href="/assets/css/0.styles.542f065b.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://excalidraw.com/apple-touch-icon.png" alt="è·³è·³çŒª" class="logo"> <span class="site-name can-hide">è·³è·³çŒª</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/java/JAVAåŸºç¡€.html" class="nav-link">JAVA</a></div><div class="nav-item"><a href="/md/database/mysql/MySqlæ“ä½œ.html" class="nav-link">æ•°æ®åº“</a></div><div class="nav-item"><a href="/md/opSystem/linux/linuxæ“ä½œç¬”è®°.html" class="nav-link">æ“ä½œç³»ç»Ÿ</a></div><div class="nav-item"><a href="/md/middleware/mq/æ¶ˆæ¯é˜Ÿåˆ—.html" class="nav-link">ä¸­é—´ä»¶</a></div><div class="nav-item"><a href="/md/tool/docker/docker.html" class="nav-link">å¼€å‘å·¥å…·</a></div><div class="nav-item"><a href="/md/designPattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div><div class="nav-item"><a href="/md/netty/BIOã€NIOã€AIO.html" class="nav-link">netty</a></div><div class="nav-item"><a href="/md/DDD/å°å‚…å“¥æ¡ˆä¾‹å­¦ä¹ æ‰“å¡/DDDæŠ½å¥–ç³»ç»Ÿå­¦ä¹ æ‰“å¡ğŸš€ day 1.html" class="nav-link">DDD</a></div><div class="nav-item"><a href="/md/other/é¢è¯•é¢˜.html" class="nav-link">other</a></div><div class="nav-item"><a href="/md/notes/" class="nav-link">æµ‹è¯•</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æç¤ºè¯­" class="dropdown-title"><!----> <span class="title" style="display:;">æµ‹è¯•ä¸‹æ‹‰èœå•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">èœå•1</a></li><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">èœå•2</a></li><li class="dropdown-item"><h4>å¤šæ¬¡èœå•</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/notes/" class="nav-link">å¤šçº§èœå•1</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/md/java/JAVAåŸºç¡€.html" class="nav-link">JAVA</a></div><div class="nav-item"><a href="/md/database/mysql/MySqlæ“ä½œ.html" class="nav-link">æ•°æ®åº“</a></div><div class="nav-item"><a href="/md/opSystem/linux/linuxæ“ä½œç¬”è®°.html" class="nav-link">æ“ä½œç³»ç»Ÿ</a></div><div class="nav-item"><a href="/md/middleware/mq/æ¶ˆæ¯é˜Ÿåˆ—.html" class="nav-link">ä¸­é—´ä»¶</a></div><div class="nav-item"><a href="/md/tool/docker/docker.html" class="nav-link">å¼€å‘å·¥å…·</a></div><div class="nav-item"><a href="/md/designPattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div><div class="nav-item"><a href="/md/netty/BIOã€NIOã€AIO.html" class="nav-link">netty</a></div><div class="nav-item"><a href="/md/DDD/å°å‚…å“¥æ¡ˆä¾‹å­¦ä¹ æ‰“å¡/DDDæŠ½å¥–ç³»ç»Ÿå­¦ä¹ æ‰“å¡ğŸš€ day 1.html" class="nav-link">DDD</a></div><div class="nav-item"><a href="/md/other/é¢è¯•é¢˜.html" class="nav-link">other</a></div><div class="nav-item"><a href="/md/notes/" class="nav-link">æµ‹è¯•</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æç¤ºè¯­" class="dropdown-title"><!----> <span class="title" style="display:;">æµ‹è¯•ä¸‹æ‹‰èœå•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">èœå•1</a></li><li class="dropdown-item"><!----> <a href="/md/notes/" class="nav-link">èœå•2</a></li><li class="dropdown-item"><h4>å¤šæ¬¡èœå•</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/notes/" class="nav-link">å¤šçº§èœå•1</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ¶ˆæ¯ä¸­é—´ä»¶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/799774/" class="sidebar-link">æ¶ˆæ¯é˜Ÿåˆ—</a></li><li><a href="/pages/3feb62/" class="sidebar-link">RabbitMQå®ç°å»¶æ—¶é˜Ÿåˆ—+æ‹“å±•</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Elasticsearch</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/3c9356/" aria-current="page" class="active sidebar-link">Elasticsearch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#cat" class="sidebar-link">_cat</a></li><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#ä¿å­˜æ–‡æ¡£" class="sidebar-link">ä¿å­˜æ–‡æ¡£</a></li><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#æŸ¥è¯¢æ–‡æ¡£" class="sidebar-link">æŸ¥è¯¢æ–‡æ¡£</a></li><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#æ›´æ–°æ–‡æ¡£" class="sidebar-link">æ›´æ–°æ–‡æ¡£</a></li><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#åˆ é™¤æ–‡æ¡£" class="sidebar-link">åˆ é™¤æ–‡æ¡£</a></li><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#æ‰¹é‡æ“ä½œæ–‡æ¡£" class="sidebar-link">æ‰¹é‡æ“ä½œæ–‡æ¡£</a></li><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#query-dsl" class="sidebar-link">Query DSL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#_1-match-åŒ¹é…æŸ¥è¯¢" class="sidebar-link">1. match åŒ¹é…æŸ¥è¯¢</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#_2-match-phrase-çŸ­è¯­åŒ¹é…" class="sidebar-link">2. match_phrase çŸ­è¯­åŒ¹é…</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#_3-multi-matchå¤šå­—æ®µåŒ¹é…" class="sidebar-link">3. multi_matchå¤šå­—æ®µåŒ¹é…</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#_4-boolå¤åˆæŸ¥è¯¢" class="sidebar-link">4. boolå¤åˆæŸ¥è¯¢</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#_5-filter-è¿‡æ»¤æŸ¥è¯¢" class="sidebar-link">5.filter è¿‡æ»¤æŸ¥è¯¢</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#_6-termç²¾ç¡®åŒ¹é…æŸ¥è¯¢" class="sidebar-link">6.termç²¾ç¡®åŒ¹é…æŸ¥è¯¢</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#aggregations-èšåˆ" class="sidebar-link">Aggregations èšåˆ</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#å…³äº" class="sidebar-link">å…³äº</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#metrics-æŒ‡æ ‡" class="sidebar-link">Metrics æŒ‡æ ‡</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#bucket-æ¡¶" class="sidebar-link">Bucket æ¡¶</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#å•ä¸ªèšåˆæˆ–è€…å¤šä¸ªå¹³çº§èšåˆ" class="sidebar-link">å•ä¸ªèšåˆæˆ–è€…å¤šä¸ªå¹³çº§èšåˆ</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#çˆ¶å­çº§èšåˆ" class="sidebar-link">çˆ¶å­çº§èšåˆ</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#mapping" class="sidebar-link">Mapping</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#æŸ¥çœ‹mappingä¿¡æ¯" class="sidebar-link">æŸ¥çœ‹mappingä¿¡æ¯</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#åˆ›å»ºæ˜ å°„" class="sidebar-link">åˆ›å»ºæ˜ å°„</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#åˆ†è¯" class="sidebar-link">åˆ†è¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#å®‰è£…ikåˆ†è¯å™¨" class="sidebar-link">å®‰è£…ikåˆ†è¯å™¨</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#è‡ªå®šä¹‰æ‹“å±•è¯åº“" class="sidebar-link">è‡ªå®šä¹‰æ‹“å±•è¯åº“</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/3c9356/#æ•´åˆspringboot" class="sidebar-link">æ•´åˆspringboot</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#å¯¼å…¥åŒ…" class="sidebar-link">å¯¼å…¥åŒ…</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#å†™é…ç½®" class="sidebar-link">å†™é…ç½®</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#å­˜å‚¨æ•°æ®" class="sidebar-link">å­˜å‚¨æ•°æ®</a></li><li class="sidebar-sub-header level3"><a href="/pages/3c9356/#å¤æ‚æ£€ç´¢" class="sidebar-link">å¤æ‚æ£€ç´¢</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>md</span></li><li data-v-06225672><span data-v-06225672>middleware</span></li><li data-v-06225672><span data-v-06225672>es</span></li></ul> <div class="info" data-v-06225672><!----> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-10-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Elasticsearch<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> Elasticsearch</h1> <h1 id="åŸºç¡€æ“ä½œ"><a href="#åŸºç¡€æ“ä½œ" class="header-anchor">#</a> åŸºç¡€æ“ä½œ</h1> <p>ç´¢å¼•(index)-ç±»å‹(type)-æ•°æ®(id)</p> <h2 id="cat"><a href="#cat" class="header-anchor">#</a> _cat</h2> <div class="language- extra-class"><pre class="language-text"><code>GET /_cat/nodes     æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
GET /_cat/health    æŸ¥çœ‹eså¥åº·çŠ¶æ€
GET /_cat/master    æŸ¥çœ‹ä¸»èŠ‚ç‚¹ä¿¡æ¯
GET /_cat/indlces   æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•

</code></pre></div><h2 id="ä¿å­˜æ–‡æ¡£"><a href="#ä¿å­˜æ–‡æ¡£" class="header-anchor">#</a> ä¿å­˜æ–‡æ¡£</h2> <div class="language- extra-class"><pre class="language-text"><code>PUTæˆ–POSTéƒ½å¯ä»¥  /customer/external/1       customerç´¢å¼•,externalç±»å‹,è®°å½•idä¸º1{    &quot;name&quot;:&quot;donny&quot;}å¤šæ¬¡è¯·æ±‚æ˜¯æ›´æ–°æ“ä½œPUTæ–°å¢å¿…é¡»å¸¦ID, POSTä¸å¸¦IDä¼šè‡ªåŠ¨ç”Ÿäº§
</code></pre></div><h2 id="æŸ¥è¯¢æ–‡æ¡£"><a href="#æŸ¥è¯¢æ–‡æ¡£" class="header-anchor">#</a> æŸ¥è¯¢æ–‡æ¡£</h2> <div class="language- extra-class"><pre class="language-text"><code>GET    /customer/external/1                è·å–customerä¸‹externalç±»å‹ä¸­è®°å½•idä¸º1çš„æ•°æ®
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>    <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;customer&quot;</span><span class="token punctuation">,</span>       <span class="token comment">//å“ªä¸ªç´¢å¼•    &quot;_type&quot;: &quot;external&quot;,        //å“ªä¸ªç±»å‹,7.0ä¹‹åä¸å»ºè®®ä½¿ç”¨ç±»å‹,8.0ä¹‹åå°±å»æ‰äº†    &quot;_id&quot;: &quot;2&quot;,                 //è®°å½•id    &quot;_version&quot;: 4,              //ç‰ˆæœ¬å·    &quot;_seq_no&quot;: 7,               //å¹¶å‘æ§åˆ¶å­—æ®µ,æ¯æ¬¡æ›´æ–°éƒ½åŠ 1(è¿™ä¸ªé€’å¢é’ˆå¯¹æ‰€æœ‰æ•°æ®çš„æ“ä½œéƒ½å…±ç”¨ä¸€ä¸ªåºåˆ—å·),ç”¨æ¥åšä¹è§‚é”    &quot;_primary_term&quot;: 1,         //    &quot;found&quot;: true,    &quot;_source&quot;: {                //çœŸæ­£çš„æ•°æ®        &quot;name&quot;: &quot;donny&quot;    }}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>?if_seq_no=12&amp;if_primary_term=1     è¯·æ±‚åé¢æ‹¼æ¥å‚æ•°,ç”¨æ¥åˆ¤æ–­seq_noå’Œprimary_term,åŒ¹é…ç›¸åŒæ‰ä¼šæ‰§è¡Œ
</code></pre></div><h2 id="æ›´æ–°æ–‡æ¡£"><a href="#æ›´æ–°æ–‡æ¡£" class="header-anchor">#</a> æ›´æ–°æ–‡æ¡£</h2> <div class="language- extra-class"><pre class="language-text"><code>POST   /customer/external/1/_update{    &quot;doc&quot;:{        &quot;name&quot;:&quot;donny&quot;    }}æˆ–è€…ä¸åŠ _update,åƒåˆ›å»ºæ–‡æ¡£ä¸€æ ·ç›´æ¥postæˆ–è€…putæ›´æ–°åŒºåˆ«:postå¸¦_updateä¼šå¯¹æ¯”åŸæ¥æ•°æ®, å¦‚æœæ•°æ®ç›¸åŒåˆ™ä¸æ‰§è¡Œæ“ä½œ,è€Œputæˆ–è€…postä¸å¸¦_update, ä¼šç›´æ¥ä¿®æ”¹å¸¦_updateæ—¶åªä¼šå¯¹ä½ ä¼ çš„å±æ€§è¿›è¡Œåˆ¤æ–­å’Œæ“ä½œå½±å“,è€Œä¸å¸¦_updateæ˜¯ç›´æ¥å°†æ•´ä¸ªæ–‡æ¡£è¦†ç›–,æ¯”å¦‚åªä¼ ä¸€ä¸ªå±æ€§age,é‚£ä¹ˆ_updateçš„ä¼šè¡¥å……è¿™ä¸ªå±æ€§ä¸å½±å“å…¶ä»–å±æ€§,è€Œä¸å¸¦æ—¶æ˜¯ç›´æ¥å°†æ•´ä¸ªdocè¦†ç›–åªæœ‰ageå±æ€§.
</code></pre></div><h2 id="åˆ é™¤æ–‡æ¡£"><a href="#åˆ é™¤æ–‡æ¡£" class="header-anchor">#</a> åˆ é™¤æ–‡æ¡£</h2> <div class="language- extra-class"><pre class="language-text"><code>DELETE   /customer/external/1      åˆ é™¤æŒ‡å®šçš„è®°å½•idçš„æ–‡æ¡£
DELETE   /customer                 ç›´æ¥åˆ é™¤ç´¢å¼•, æ²¡æœ‰ç›´æ¥åˆ é™¤ç±»å‹çš„æ“ä½œ
</code></pre></div><h2 id="æ‰¹é‡æ“ä½œæ–‡æ¡£"><a href="#æ‰¹é‡æ“ä½œæ–‡æ¡£" class="header-anchor">#</a> æ‰¹é‡æ“ä½œæ–‡æ¡£</h2> <div class="language- extra-class"><pre class="language-text"><code>POST   /customer/external/_bulk{&quot;index&quot;:{&quot;_id&quot;:&quot;1&quot;}}{&quot;name&quot;:&quot;danny&quot;}{&quot;index&quot;:{&quot;_id&quot;:&quot;2&quot;}}{&quot;name&quot;:&quot;jane&quot;}è¯­æ³•æ ¼å¼:{&quot;action&quot;:{metadata}}        //æ“ä½œ  æºæ•°æ®(ä¹Ÿå°±æ˜¯çŸ¥åç´¢å¼•,ç±»å‹,idå•¥çš„, å¦‚æœè·¯å¾„ä¸Šç´¢å¼•åˆ™è¿™é‡Œå¯ä»¥ä¸å†™){&quot;name&quot;:&quot;danny&quot;}             //æ–‡æ¡£æœ¬èº«POST   /_bulk//åˆ é™¤è®°å½•{&quot;delete&quot;:{&quot;_index&quot;:&quot;customer&quot;,&quot;_type&quot;:&quot;external&quot;,&quot;_id&quot;:&quot;1&quot;}}//åˆ›å»ºè®°å½•{&quot;create&quot;:{&quot;_index&quot;:&quot;customer&quot;,&quot;_type&quot;:&quot;external&quot;,&quot;_id&quot;:&quot;1&quot;}}{&quot;name&quot;:&quot;danny&quot;}//æ’å…¥è®°å½•{&quot;index&quot;:{&quot;_index&quot;:&quot;customer&quot;,&quot;_type&quot;:&quot;external&quot;,&quot;_id&quot;:&quot;1&quot;}}{&quot;name&quot;:&quot;danny&quot;}//æ›´æ–°è®°å½•{&quot;update&quot;:{&quot;_index&quot;:&quot;customer&quot;,&quot;_type&quot;:&quot;external&quot;,&quot;_id&quot;:&quot;1&quot;}}{&quot;doc&quot;:{&quot;name&quot;:&quot;danny&quot;}}
</code></pre></div><h1 id="è¿›é˜¶æ“ä½œ"><a href="#è¿›é˜¶æ“ä½œ" class="header-anchor">#</a> è¿›é˜¶æ“ä½œ</h1> <h2 id="query-dsl"><a href="#query-dsl" class="header-anchor">#</a> Query DSL</h2> <div class="language- extra-class"><pre class="language-text"><code>GET /bank/_search{  &quot;query&quot;: { &quot;match_all&quot;: {} },    //æŸ¥è¯¢æ¡ä»¶     match_allåŒ¹é…æ‰€æœ‰  &quot;sort&quot;: [                        //æ’åºè§„åˆ™, å¯ä»¥æœ‰ç»„åˆæ’åº    { &quot;account_number&quot;: &quot;asc&quot; }    //æ ¹æ®account_numberå‡åºæ’åˆ—  ],  &quot;from&quot;: 10,       //ä»ç¬¬10æ¡å¼€å§‹  &quot;size&quot;: 10        //å–10æ¡è®°å½•}
</code></pre></div><h3 id="_1-match-åŒ¹é…æŸ¥è¯¢"><a href="#_1-match-åŒ¹é…æŸ¥è¯¢" class="header-anchor">#</a> 1. match åŒ¹é…æŸ¥è¯¢</h3> <div class="language- extra-class"><pre class="language-text"><code>GET /bank/_search{  &quot;query&quot;: {    &quot;match&quot;: {                     //å…¨æ–‡æ£€ç´¢,æŒ‰ç…§è¯„åˆ†æ’åº,ä¼šå¯¹æ£€ç´¢æ¡ä»¶è¿›è¡Œåˆ†è¯åŒ¹é…        &quot;address&quot;: &quot;mill lane&quot;      //addresså±æ€§ä¸­åŒ…å«millæˆ–laneéƒ½ä¼šè¢«è¯„åˆ†åè¿”å›,å¯¹äºæ•°å­—çš„ä¼šç²¾ç¡®åŒ¹é…    }  }}
</code></pre></div><h3 id="_2-match-phrase-çŸ­è¯­åŒ¹é…"><a href="#_2-match-phrase-çŸ­è¯­åŒ¹é…" class="header-anchor">#</a> 2. match_phrase çŸ­è¯­åŒ¹é…</h3> <div class="language- extra-class"><pre class="language-text"><code>GET /bank/_search{  &quot;query&quot;: {    &quot;match_phrase&quot;: {                //ä¸ä¼šå¯¹æ£€ç´¢æ¡ä»¶è¿›è¡Œåˆ†è¯åŒ¹é…        &quot;address&quot;: &quot;mill lane&quot;      //addresså±æ€§ä¸­åŒ…å«&quot;mill lane&quot;éƒ½ä¼šè¢«è¯„åˆ†åè¿”å›,å¯¹äºæ•°å­—çš„ä¼šç²¾ç¡®åŒ¹é…    }  }}
</code></pre></div><h3 id="_3-multi-matchå¤šå­—æ®µåŒ¹é…"><a href="#_3-multi-matchå¤šå­—æ®µåŒ¹é…" class="header-anchor">#</a> 3. multi_matchå¤šå­—æ®µåŒ¹é…</h3> <div class="language- extra-class"><pre class="language-text"><code>GET /bank/_search{  &quot;query&quot;: {    &quot;multi_match&quot;: {      &quot;query&quot;: &quot;Mill Road&quot;,             //æ£€ç´¢æ¡ä»¶, ä¼šè¿›è¡Œåˆ†è¯      &quot;fields&quot;: [&quot;address&quot;,&quot;email&quot;]     //éœ€è¦æ£€ç´¢çš„å­—æ®µ    }  }}
</code></pre></div><h3 id="_4-boolå¤åˆæŸ¥è¯¢"><a href="#_4-boolå¤åˆæŸ¥è¯¢" class="header-anchor">#</a> 4. boolå¤åˆæŸ¥è¯¢</h3> <p>å¤åˆè¯­å¥å¯ä»¥åˆå¹¶ä»»ä½•å…¶ä»–æŸ¥è¯¢è¯­å¥, åŒ…æ‹¬å¤åˆè¯­å¥</p> <p>must, must_not, should éƒ½ä¼šå½±å“ç›¸å…³æ€§çš„å¾—åˆ†</p> <p>filterè¿‡æ»¤ä¸ä¼šå½±å“ç›¸å…³æ€§å¾—åˆ†</p> <div class="language- extra-class"><pre class="language-text"><code>GET /bank/_search{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
         //å¿…é¡»æ»¡è¶³çš„
        { &quot;match&quot;: { &quot;gender&quot;: &quot;m&quot; } }
      ],
      &quot;must_not&quot;: [
      //å¿…é¡»ä¸æ»¡è¶³çš„
        { &quot;match&quot;: { &quot;state&quot;: &quot;tn&quot; } }
      ],
      &quot;should&quot;: [
       //åº”è¯¥æ»¡è¶³çš„ä¸æ»¡è¶³ä¹Ÿè¡Œ
        {&quot;match&quot;:{&quot;age&quot;:32}}
      ],
      &quot;filter&quot;: {
        &quot;range&quot;: {
    //åŒºé—´
          &quot;balance&quot;: {
            &quot;gte&quot;: 20000,
            &quot;lte&quot;: 30000
          }
        }
      }
    }
  }}
</code></pre></div><h3 id="_5-filter-è¿‡æ»¤æŸ¥è¯¢"><a href="#_5-filter-è¿‡æ»¤æŸ¥è¯¢" class="header-anchor">#</a> 5.filter è¿‡æ»¤æŸ¥è¯¢</h3> <p>filterè¿‡æ»¤ä¸ä¼šå½±å“ç›¸å…³æ€§å¾—åˆ†, çœ‹ç¬¬å››æ¡</p> <h3 id="_6-termç²¾ç¡®åŒ¹é…æŸ¥è¯¢"><a href="#_6-termç²¾ç¡®åŒ¹é…æŸ¥è¯¢" class="header-anchor">#</a> 6.termç²¾ç¡®åŒ¹é…æŸ¥è¯¢</h3> <p>ç²¾ç¡®æ£€ç´¢çš„æ¨èterm, æ–‡æœ¬å­—æ®µä¸æ¨è</p> <div class="language- extra-class"><pre class="language-text"><code>GET /bank/_search{  &quot;query&quot;: {    &quot;term&quot;: {      &quot;age&quot;:&quot;28&quot;    }  }}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>//å¦‚æœæ–‡æœ¬ä¹Ÿè¦ç²¾ç¡®åŒ¹é…ä¸åˆ†è¯, é‚£ä¹ˆå¯ä»¥ä½¿ç”¨address.keywordä½œä¸ºkey, è¿›è¡Œç²¾å‡†åŒ¹é…å®Œæˆç›¸åŒæ‰ä¼šè¿”å›//ä¸match_phraseçš„åŒºåˆ«æ˜¯, match_phraseæ˜¯çŸ­è¯­åŒ¹é…,åªæ˜¯åŒ…å«è¯¥çŸ­è¯­å³å¯GET /bank/_search{  &quot;query&quot;: {    &quot;match&quot;: {      &quot;address.keyword&quot;:&quot;789 Madison Street&quot;    }  }}
</code></pre></div><h3 id="aggregations-èšåˆ"><a href="#aggregations-èšåˆ" class="header-anchor">#</a> Aggregations èšåˆ</h3> <h3 id="å…³äº"><a href="#å…³äº" class="header-anchor">#</a> å…³äº</h3> <p>Aggregationsçš„éƒ¨åˆ†ç‰¹æ€§ç±»ä¼¼äºSQLè¯­è¨€ä¸­çš„group byï¼Œavgï¼Œsumç­‰å‡½æ•°ã€‚ä½†Aggregations APIè¿˜æä¾›äº†æ›´åŠ å¤æ‚çš„ç»Ÿè®¡åˆ†ææ¥å£ã€‚</p> <p>æŒæ¡Aggregationséœ€è¦ç†è§£ä¸¤ä¸ªæ¦‚å¿µï¼š</p> <ul><li>æ¡¶(Buckets)ï¼šç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆï¼Œç›¸å½“äºSQLä¸­çš„group byã€‚æ¯”å¦‚ï¼Œåœ¨usersè¡¨ä¸­ï¼ŒæŒ‰â€œåœ°åŒºâ€èšåˆï¼Œä¸€ä¸ªäººå°†è¢«åˆ†åˆ°åŒ—äº¬æ¡¶æˆ–ä¸Šæµ·æ¡¶æˆ–å…¶ä»–æ¡¶é‡Œï¼›æŒ‰â€œæ€§åˆ«â€èšåˆï¼Œä¸€ä¸ªäººå°†è¢«åˆ†åˆ°ç”·æ¡¶æˆ–å¥³æ¡¶</li> <li>æŒ‡æ ‡(Metrics)ï¼šåŸºäºBucketsçš„åŸºç¡€ä¸Šè¿›è¡Œç»Ÿè®¡åˆ†æï¼Œç›¸å½“äºSQLä¸­çš„count,avg,sumç­‰ã€‚æ¯”å¦‚ï¼ŒæŒ‰â€œåœ°åŒºâ€èšåˆï¼Œè®¡ç®—æ¯ä¸ªåœ°åŒºçš„äººæ•°ï¼Œå¹³å‡å¹´é¾„ç­‰</li></ul> <p>GROUP BYç›¸å½“äºåšåˆ†æ¡¶çš„å·¥ä½œï¼ŒCOUNTæ˜¯ç»Ÿè®¡æŒ‡æ ‡ã€‚</p> <h3 id="metrics-æŒ‡æ ‡"><a href="#metrics-æŒ‡æ ‡" class="header-anchor">#</a> Metrics æŒ‡æ ‡</h3> <p>AVG //å¹³å‡å€¼</p> <p>Cardinality //æ±‚åŸºæ•°,æ¯”å¦‚æ‰€æœ‰äººä¸­ageå…±åˆ†äº†å‡ ç»„</p> <p>stats //ç»Ÿè®¡,ä¼šå¾—å‡ºcount, max,min,avg,sum</p> <h3 id="bucket-æ¡¶"><a href="#bucket-æ¡¶" class="header-anchor">#</a> Bucket æ¡¶</h3> <p>terms //èšåˆ,æ¯ä¸ªåˆ†ç»„ä¸­çš„å…ƒç´ æ•°é‡</p> <h3 id="å•ä¸ªèšåˆæˆ–è€…å¤šä¸ªå¹³çº§èšåˆ"><a href="#å•ä¸ªèšåˆæˆ–è€…å¤šä¸ªå¹³çº§èšåˆ" class="header-anchor">#</a> å•ä¸ªèšåˆæˆ–è€…å¤šä¸ªå¹³çº§èšåˆ</h3> <div class="language- extra-class"><pre class="language-text"><code>//æœç´¢addressä¸­åŒ…å«millçš„äººçš„å¹´é¾„åˆ†å¸ƒä»¥åŠå¹³å‡å¹´é¾„
GET bank/_search{
  &quot;query&quot;:{
    &quot;match&quot;: {
      &quot;address&quot;: &quot;mill&quot;
    }
  },
  &quot;aggs&quot;: {
    &quot;ageagg&quot;: {
             //ç¬¬ä¸€ä¸ªèšåˆçš„åç§°
      &quot;terms&quot;: {
            //èšåˆç±»å‹
        &quot;field&quot;: &quot;age&quot;,
        &quot;size&quot;: 100
         //
      }
    },
    &quot;ageavg&quot;:{
             //ç¬¬äºŒä¸ªèšåˆçš„åç§°
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;age&quot;
      }
    }
  },
  &quot;size&quot;:0
}
</code></pre></div><p>æŸ¥è¯¢ç»“æœ:</p> <div class="language- extra-class"><pre class="language-text"><code>{  &quot;took&quot; : 1,  &quot;timed_out&quot; : false,  &quot;_shards&quot; : {    &quot;total&quot; : 1,    &quot;successful&quot; : 1,    &quot;skipped&quot; : 0,    &quot;failed&quot; : 0  },  &quot;hits&quot; : {    &quot;total&quot; : {      &quot;value&quot; : 4,      &quot;relation&quot; : &quot;eq&quot;    },    &quot;max_score&quot; : null,    &quot;hits&quot; : [ ]  },  &quot;aggregations&quot; : {    &quot;ageagg&quot; : {                                      //èšåˆåç§°      &quot;doc_count_error_upper_bound&quot; : 0,      &quot;sum_other_doc_count&quot; : 0,      &quot;buckets&quot; : [                                   //æ¡¶, ä¸‹é¢keyä¾¿æ˜¯å„ç§å€¼,doc_countæ˜¯æ¯ç§å€¼å¯¹åº”çš„ä¸ªæ•°        {          &quot;key&quot; : 38,          &quot;doc_count&quot; : 2        },        {          &quot;key&quot; : 28,          &quot;doc_count&quot; : 1        },        {          &quot;key&quot; : 32,          &quot;doc_count&quot; : 1        }      ]    },    &quot;ageavg&quot; : {                                 //ç¬¬äºŒä¸ªèšåˆ      &quot;value&quot; : 34.0    }  }}
</code></pre></div><h3 id="çˆ¶å­çº§èšåˆ"><a href="#çˆ¶å­çº§èšåˆ" class="header-anchor">#</a> çˆ¶å­çº§èšåˆ</h3> <div class="language- extra-class"><pre class="language-text"><code>##æŒ‰ç…§å¹´é¾„èšåˆ,æ¯ä¸ªå¹´é¾„çš„å¹³å‡è–ªèµ„å’Œè¯¥å¹´é¾„ç”·å¥³çš„äººæ•°åŠå¹³å‡è–ªèµ„
GET bank/_search{
  &quot;query&quot;:{
    &quot;match_all&quot;: {}
  },
  &quot;aggs&quot;: {
                  
      //ç¬¬ä¸€çº§èšåˆ,æ ¹æ®å¹´é¾„åˆ†ç»„
    &quot;ageagg&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;age&quot;,
        &quot;size&quot;: 100
      },
      &quot;aggs&quot;: {
                             
//ç¬¬äºŒçº§èšåˆ
        &quot;balanceavg&quot;: {
          &quot;avg&quot;: {
                          //ç¬¬äºŒçº§èšåˆ,1. æ±‚è¿™ä¸ªå¹´é¾„æ®µæ‰€æœ‰äººçš„å¹³å‡è–ªèµ„
            &quot;field&quot;: &quot;balance&quot;
          }
        },
        &quot;genderagg&quot;:{
                       //ç¬¬äºŒçº§èšåˆ,2. æ ¹æ®æ€§åˆ«å†åˆ†ç»„
          &quot;terms&quot;: {
            &quot;field&quot;: &quot;gender.keyword&quot;, //termsç²¾ç¡®åŒ¹é…,æ–‡æœ¬å­—æ®µéœ€è¦ä½¿ç”¨.keyword            &quot;size&quot;: 10
          },
          &quot;aggs&quot;: {
                                     //ç¬¬ä¸‰çº§èšåˆ,è¯¥æ€§åˆ«åˆ†ç»„ä¸‹çš„å¹³å‡è–ªèµ„
            &quot;balanceavg&quot;: {
              &quot;avg&quot;: {
                &quot;field&quot;: &quot;balance&quot;
              }
            }
          }
        }
      }
    }
  }
,  &quot;size&quot;: 0}
</code></pre></div><p>èšåˆç»“æœ:</p> <div class="language- extra-class"><pre class="language-text"><code>   //æˆªå–ç»“æœä¸­ä¸€çº§åˆ†ç±»ä¸­ä¸€ä¸ªæ¡¶å…ƒç´ åˆ†æ, ä¸ªäººç²—ä¿—ç†è§£    &quot;buckets&quot; : [        {          &quot;key&quot; : 31,                       //ä¸€çº§èšåˆåä¸€ä¸ªæ¡¶          &quot;doc_count&quot; : 61,                 //è¯¥æ¡¶çš„å…ƒç´ æ•°é‡          &quot;genderagg&quot; : {            &quot;doc_count_error_upper_bound&quot; : 0,            &quot;sum_other_doc_count&quot; : 0,            &quot;buckets&quot; : [                         //äºŒçº§èšåˆ 2.æ ¹æ®æ€§åˆ«å†åˆ†ç»„              {                &quot;key&quot; : &quot;M&quot;,                &quot;doc_count&quot; : 35,                &quot;balanceavg&quot; : {                            //ä¸‰çº§èšåˆ                  &quot;value&quot; : 29565.628571428573                }              },              {                &quot;key&quot; : &quot;F&quot;,                &quot;doc_count&quot; : 26,                &quot;balanceavg&quot; : {                  &quot;value&quot; : 26626.576923076922                }              }            ]          },          &quot;balanceavg&quot; : {                    //äºŒçº§èšåˆ 1. æ±‚è¿™ä¸ªå¹´é¾„æ®µæ‰€æœ‰äººçš„å¹³å‡è–ªèµ„            &quot;value&quot; : 28312.918032786885          }        },        .......]
</code></pre></div><h2 id="mapping"><a href="#mapping" class="header-anchor">#</a> Mapping</h2> <p>Mappingæ˜¯ç”¨æ¥å®šä¹‰ä¸€ä¸ªæ–‡æ¡£(document), ä»¥åŠå®ƒæ‰€åŒ…å«çš„å±æ€§(field)æ˜¯å¦‚ä½•å­˜å‚¨å’Œç´¢å¼•çš„. æ¯”å¦‚ä½¿ç”¨mappingæ¥å®šä¹‰: å“ªäº›å­—ç¬¦å±æ€§åº”è¯¥è¢«çœ‹ä½œæ˜¯å…¨æ–‡æœ¬å±æ€§(full text fields) å“ªäº›å±æ€§åŒ…å«æ•°å­—,æ—¥æœŸæˆ–è€…åœ°ç†ä½ç½® æ–‡æ¡£ä¸­æ‰€æœ‰çš„å±æ€§æ˜¯å¦éƒ½èƒ½è¢«ç´¢å¼• (_all é…ç½®) æ—¥æœŸçš„æ ¼å¼ è‡ªå®šä¹‰æ˜ å°„è§„åˆ™æ¥æ‰§è¡ŒåŠ¨æ€æ·»åŠ å±æ€§</p> <h3 id="æŸ¥çœ‹mappingä¿¡æ¯"><a href="#æŸ¥çœ‹mappingä¿¡æ¯" class="header-anchor">#</a> æŸ¥çœ‹mappingä¿¡æ¯</h3> <div class="language- extra-class"><pre class="language-text"><code>GET bank/_mapping
</code></pre></div><h3 id="åˆ›å»ºæ˜ å°„"><a href="#åˆ›å»ºæ˜ å°„" class="header-anchor">#</a> åˆ›å»ºæ˜ å°„</h3> <div class="language- extra-class"><pre class="language-text"><code>//åˆ›å»ºæ–°çš„ç´¢å¼•,å¹¶æŒ‡å®šæ˜ å°„PUT /my_index{  &quot;mappings&quot;: {    &quot;properties&quot;:{      &quot;age&quot;: {&quot;type&quot;: &quot;integer&quot;},      &quot;email&quot;: {&quot;type&quot;: &quot;keyword&quot;},      &quot;name&quot;: {&quot;type&quot;: &quot;text&quot;}    }  }}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>//å‘ç´¢å¼•ä¸­è¿½åŠ ä¸€ä¸ªå±æ€§PUT /my_index/_mapping{  &quot;properties&quot;: {    &quot;lick&quot;: {      &quot;type&quot;: &quot;text&quot;,      &quot;index&quot;:false     //indexæ§åˆ¶è¿™ä¸ªå€¼èƒ½ä¸èƒ½è¢«ç´¢å¼•,é»˜è®¤æ˜¯true, å¦‚æœè®¾ç½®falseé‚£ä¹ˆè¿™ä¸ªå­—æ®µä¸èƒ½è¢«æ£€ç´¢    }  }}
</code></pre></div><p>å¯¹äºå·²ç»å­˜åœ¨çš„å±æ€§å­—æ®µæ˜¯ä¸èƒ½è¢«æ›´æ–°æ˜ å°„çš„, åªèƒ½æ–°å»ºä¸€ä¸ªç´¢å¼•, ç„¶åè¿›è¡Œæ•°æ®è¿ç§»</p> <div class="language- extra-class"><pre class="language-text"><code>//æ•°æ®è¿ç§»POST _reindex{  &quot;source&quot;: {           //æ¥æº  å¦‚æœæ²¡æœ‰typeå¯ä»¥ä¸æŒ‡å®š    &quot;index&quot;: &quot;bank&quot;,    &quot;type&quot;: &quot;account&quot;  },  &quot;dest&quot;: {             //ç›®æ ‡    &quot;index&quot;: &quot;newbank&quot;  }}
</code></pre></div><h2 id="åˆ†è¯"><a href="#åˆ†è¯" class="header-anchor">#</a> åˆ†è¯</h2> <p>ä¸€ä¸ªtokenizer(åˆ†è¯å™¨) æ¥æ”¶ä¸€ä¸ªå­—ç¬¦æµ, å°†ä¹‹åˆ†å‰²ä¸ºç‹¬ç«‹çš„tokens(è¯å…ƒ, é€šå¸¸æ˜¯ç‹¬ç«‹çš„å•è¯) , ç„¶åè¾“å‡ºtokensæµ</p> <h3 id="å®‰è£…ikåˆ†è¯å™¨"><a href="#å®‰è£…ikåˆ†è¯å™¨" class="header-anchor">#</a> å®‰è£…ikåˆ†è¯å™¨</h3> <p>éœ€è¦å®‰è£…å¯¹åº”esç‰ˆæœ¬çš„ikåˆ†è¯å™¨</p> <p>https://github.com/medcl/elasticsearch-analysis-ik/releases ä»githubæ‰¾å¯¹åº”ç‰ˆæœ¬</p> <p>è§£å‹åœ¨pluginç›®å½•ä¸‹</p> <p>elasticsearch-plugin list æŸ¥çœ‹å®‰è£…å¥½çš„æ’ä»¶, é‡å¯</p> <p>ä½¿ç”¨åˆ†è¯å™¨</p> <div class="language- extra-class"><pre class="language-text"><code>//ik_smart, ç»“æœ: æˆ‘ æ˜¯ ä¸­å›½äºº
POST _analyze
{
  &quot;analyzer&quot;: &quot;ik_smart&quot;,
  &quot;text&quot;: &quot;æˆ‘æ˜¯ä¸­å›½äºº&quot;
}

//ik_max_word, æœ€å¤§åˆ†è¯ç»„åˆ,ç»“æœ:æˆ‘ æ˜¯ ä¸­å›½äºº ä¸­å›½ å›½äºº
POST _analyze
{
  &quot;analyzer&quot;: &quot;ik_max_word&quot;,
  &quot;text&quot;: &quot;æˆ‘æ˜¯ä¸­å›½äºº&quot;
}
</code></pre></div><h3 id="è‡ªå®šä¹‰æ‹“å±•è¯åº“"><a href="#è‡ªå®šä¹‰æ‹“å±•è¯åº“" class="header-anchor">#</a> è‡ªå®šä¹‰æ‹“å±•è¯åº“</h3> <p>ä¿®æ”¹plugins/ik/config/ä¸­çš„IKAnalyzer.cfg.xmlæ–‡ä»¶</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;properties&gt;        &lt;comment&gt;IK Analyzer æ‰©å±•é…ç½®&lt;/comment&gt;        &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸,æ–‡ä»¶è¦æ”¾åœ¨configç›®å½•ä¸‹ --&gt;        &lt;entry key=&quot;ext_dict&quot;&gt;fenci.text&lt;/entry&gt;         &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;        &lt;entry key=&quot;ext_stopwords&quot;&gt;&lt;/entry&gt;        &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸,æŒ‡å®šè¿œç¨‹æ–‡ä»¶åœ°å€--&gt;        &lt;!--&lt;entry key=&quot;remote_ext_dict&quot;&gt;http://119.45.176.143/es/fenci.text&lt;/entry&gt;--&gt;        &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;        &lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;&lt;/properties&gt;
</code></pre></div><h1 id="elasticsearch-rest-client"><a href="#elasticsearch-rest-client" class="header-anchor">#</a> Elasticsearch-Rest-Client</h1> <p><strong>9300 : tcp</strong></p> <p>spring-data-elasticsearch:transport-api.jar</p> <p>springbootç‰ˆæœ¬ä¸åŒï¼Œ transport-api.jarä¸åŒ ä¸èƒ½é€‚é…esç‰ˆæœ¬</p> <p>7.xå·²ç»ä¸å»ºè®®ä½¿ç”¨,8ä»¥åå°±è¦åºŸå¼ƒ</p> <p><strong>9200 : http</strong></p> <p>jestClient: éå®˜æ–¹, æ›´æ–°æ…¢</p> <p>RestTemplate: æ¨¡æ‹Ÿå‘HTTPè¯·æ±‚, ESå¾ˆå¤šæ“ä½œéœ€è¦è‡ªå·±å°è£…,éº»çƒ¦</p> <p>HttpClient: åŒä¸Š</p> <p>Elasticsearch-Rest-Client: å®˜æ–¹RestClient, å°è£…esæ“ä½œ, APIå±‚æ¬¡åˆ†æ˜, ä¸Šæ‰‹ç®€å•</p> <h2 id="æ•´åˆspringboot"><a href="#æ•´åˆspringboot" class="header-anchor">#</a> æ•´åˆspringboot</h2> <p>https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html</p> <h3 id="å¯¼å…¥åŒ…"><a href="#å¯¼å…¥åŒ…" class="header-anchor">#</a> å¯¼å…¥åŒ…</h3> <div class="language- extra-class"><pre class="language-text"><code>&lt;dependency&gt;    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;    &lt;version&gt;7.4.2&lt;/version&gt;&lt;/dependency&gt;
</code></pre></div><h3 id="å†™é…ç½®"><a href="#å†™é…ç½®" class="header-anchor">#</a> å†™é…ç½®</h3> <div class="language- extra-class"><pre class="language-text"><code>@Configurationpublic class ElasticsearchConfig {    //é…ç½®RequestOptions    public static final RequestOptions COMMON_OPTIONS;    static {        RequestOptions.Builder builder = RequestOptions.DEFAULT.toBuilder();//        builder.addHeader(&quot;Authorization&quot;, &quot;Bearer &quot; + TOKEN);//        builder.setHttpAsyncResponseConsumerFactory(//                new HttpAsyncResponseConsumerFactory//                        .HeapBufferedResponseConsumerFactory(30 * 1024 * 1024 * 1024));        COMMON_OPTIONS = builder.build();    }    //ç»™å®¹å™¨ä¸­æ³¨å…¥ä¸€ä¸ªRestHighLevelClient    @Bean    public RestHighLevelClient esRestClient() {//        RestHighLevelClient client = new RestHighLevelClient(//                RestClient.builder(//                        new HttpHost(&quot;119.45.176.143&quot;, 9200, &quot;http&quot;)));        RestClientBuilder builder = null;        builder = RestClient.builder(new HttpHost(&quot;119.45.176.143&quot;, 9200, &quot;http&quot;));        RestHighLevelClient client = new RestHighLevelClient(builder);        return client;    }}
</code></pre></div><h3 id="å­˜å‚¨æ•°æ®"><a href="#å­˜å‚¨æ•°æ®" class="header-anchor">#</a> å­˜å‚¨æ•°æ®</h3> <p>åŒä¸€ä¸ªidå¤šæ¬¡æ‰§è¡Œæ˜¯æ›´æ–°æ“ä½œ</p> <div class="language- extra-class"><pre class="language-text"><code>    //å¯¼å…¥é…ç½®ç±»ä¸­çš„clientå¯¹è±¡    @Autowired    RestHighLevelClient client;    public void indexData() throws IOException {        //åˆ›å»ºæ’å…¥è¯·æ±‚        IndexRequest indexRequest = new IndexRequest(&quot;users&quot;);        indexRequest.id(&quot;1&quot;);  //æ•°æ®çš„is        //indexRequest.source(&quot;username&quot;,&quot;å¼ ä¸‰&quot;,&quot;age&quot;,&quot;18&quot;,&quot;gender&quot;,&quot;ç”·&quot;);        User user = new User();        user.setUserName(&quot;å¼ ä¸‰&quot;);        user.setAge(18);        user.setGender(&quot;ç”·&quot;);        String string = JSON.toJSONString(user);        indexRequest.source(string, XContentType.JSON);   //è¦ä¿å­˜çš„å†…å®¹        //æ‰§è¡Œæ“ä½œ        IndexResponse index = client.index(indexRequest, ElasticsearchConfig.COMMON_OPTIONS);        //æå–å“åº”æ•°æ®        System.out.println(index);    }
</code></pre></div><h3 id="å¤æ‚æ£€ç´¢"><a href="#å¤æ‚æ£€ç´¢" class="header-anchor">#</a> å¤æ‚æ£€ç´¢</h3> <div class="language- extra-class"><pre class="language-text"><code>//æŒ‰ç…§å¹´é¾„èšåˆ,æ¯ä¸ªå¹´é¾„çš„å¹³å‡è–ªèµ„å’Œè¯¥å¹´é¾„ç”·å¥³çš„äººæ•°åŠå¹³å‡è–ªèµ„    public void searchData() throws IOException {        //åˆ›å»ºæ£€ç´¢è¯·æ±‚        SearchRequest searchRequest = new SearchRequest();        //æŒ‡å®šç´¢å¼•        searchRequest.indices(&quot;bank&quot;);        //æŒ‡å®šDSL, æ£€ç´¢æ¡ä»¶        //SearchSourceBuilder sourceBuilder   å°è£…çš„æ£€ç´¢æ¡ä»¶        SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();        //1.1) æ„å»ºæ£€ç´¢æ¡ä»¶  sourceBuilderä¸‹éƒ½æ˜¯äº›æ ¹æ“ä½œ:query  from  size  aggregation  sortç­‰        //æŒ‰ç…§å¹´é¾„èšåˆ,æ¯ä¸ªå¹´é¾„çš„å¹³å‡è–ªèµ„å’Œè¯¥å¹´é¾„ç”·å¥³çš„äººæ•°åŠå¹³å‡è–ªèµ„        sourceBuilder.query(QueryBuilders.matchAllQuery()).size(5);        //æ ¹æ®ageåˆ†ç»„        TermsAggregationBuilder ageagg = AggregationBuilders.terms(&quot;ageagg&quot;).field(&quot;age&quot;)                .subAggregation(AggregationBuilders.avg(&quot;balanceavg&quot;).field(&quot;balance&quot;))                .subAggregation(AggregationBuilders.terms(&quot;genderagg&quot;).field(&quot;gender.keyword&quot;)                        .subAggregation(AggregationBuilders.avg(&quot;balanceavg&quot;).field(&quot;balance&quot;)));        sourceBuilder.aggregation(ageagg);        //1.2) å‘æ£€ç´¢è¯·æ±‚ä¸­æ”¾å…¥æ£€ç´¢æ¡ä»¶        searchRequest.source(sourceBuilder);        System.out.println(&quot;æ£€ç´¢æ¡ä»¶:&quot;+sourceBuilder);        //2.æ‰§è¡Œæ£€ç´¢        SearchResponse search = client.search(searchRequest, ElasticsearchConfig.COMMON_OPTIONS);        //3.åˆ†æç»“æœ        System.out.println(&quot;æ£€ç´¢ç»“æœ:&quot;+search);        System.out.println(&quot;å‘½ä¸­æ–‡æ¡£æ•°é‡:&quot;+search.getHits().getTotalHits().value);        //3.1) è·å–æ‰€æœ‰å‘½ä¸­çš„è®°å½•        SearchHit[] hits = search.getHits().getHits();        for (SearchHit hit : hits) {            //å°†stringè½¬æˆå¯¹è±¡            account account = JSON.parseObject(hit.getSourceAsString(), account.class);            System.out.println(&quot;æ£€ç´¢åˆ°çš„account:&quot;+account);        }        //3.2) è·å–åˆ†æç»“æœ        //è·å–æ‰€æœ‰èšåˆç»“æœ        Aggregations aggregations = search.getAggregations();        //å¦‚æœèšåˆæ˜¯ç”¨çš„term,é‚£å°±ç”¨termsæ¥æ”¶        Terms ageagg1 = aggregations.get(&quot;ageagg&quot;);        for (Terms.Bucket bucket : ageagg1.getBuckets()) {            String key=bucket.getKeyAsString();            long docCount = bucket.getDocCount();            //è·å–å­èšåˆ            Aggregations aggregations1 = bucket.getAggregations();            //è·å–è¯¥å¹´é¾„æ®µæ‰€æœ‰çš„äººçš„å¹³å‡å€¼            Avg balanceavg = aggregations1.get(&quot;balanceavg&quot;);            double balanceavgValue = balanceavg.getValue();            //è·å–è¯¥å¹´é¾„æ®µæ€§åˆ«åˆ†ç»„            Terms genderagg = aggregations1.get(&quot;genderagg&quot;);            long manNum = 0;            double manBalanceavgValue = 0;            long womanNum = 0;            double womanBalanceavgValue = 0;            for (Terms.Bucket genderaggBucket : genderagg.getBuckets()) {                //è·å–è¯¥æ€§åˆ«ä¸‹å¹³å‡å€¼                Avg balanceavg1 = genderaggBucket.getAggregations().get(&quot;balanceavg&quot;);                if(genderaggBucket.getKeyAsString().equals(&quot;M&quot;)){                    manNum = genderaggBucket.getDocCount();                    manBalanceavgValue = balanceavg1.getValue();                }else{                    womanNum = genderaggBucket.getDocCount();                    womanBalanceavgValue = balanceavg1.getValue();                };            }            System.out.println(&quot;åˆ†æç»“æœ:&quot;+&quot;å¹´é¾„&quot;+key+&quot;å²å…±æœ‰&quot;+docCount+&quot;äºº,å¹³å‡è–ªèµ„&quot;+balanceavgValue+&quot;å…ƒ&quot; +                    &quot;,å…¶ä¸­ç”·æ€§&quot;+manNum+&quot;äºº,å¹³å‡è–ªèµ„&quot;+manBalanceavgValue+&quot;å…ƒ&quot;+                    &quot;,å¥³æ€§&quot;+womanNum+&quot;äºº,å¹³å‡è–ªèµ„&quot;+womanBalanceavgValue+&quot;å…ƒ&quot;);        }    }
</code></pre></div></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/3feb62/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">RabbitMQå®ç°å»¶æ—¶é˜Ÿåˆ—+æ‹“å±•</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/3feb62/" class="prev">RabbitMQå®ç°å»¶æ—¶é˜Ÿåˆ—+æ‹“å±•</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2022
    <span>å¼ å¤§å–µ</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9ac200f5.js" defer></script><script src="/assets/js/2.f08c2e94.js" defer></script><script src="/assets/js/48.40e23b48.js" defer></script>
  </body>
</html>
